<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="11/26/2019 2:19:51 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="DES6071"
  DTS:CreatorName="AMS\jtrinchier"
  DTS:DTSID="{217C3205-A1B3-4C07-B335-999EF846AC1B}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Base Comisionable Control_Consistencia"
  DTS:PackageType="5"
  DTS:VersionBuild="8"
  DTS:VersionGUID="{6AF94E34-3B43-45A6-AA18-7F8ACC1D686F}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{398D2EF9-C61A-403E-9666-234983BE485A}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{398D2EF9-C61A-403E-9666-234983BE485A}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Envio mail --- Consistencia y Actualización Tablas de Dimensión"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{2D609BE5-2C0C-467E-8FE9-81706388F4A2}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Envio mail --- Consistencia y Actualización Tablas de Dimensión"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{D1837BAC-C790-4C2E-BC0E-65F1DF3613D9}"
          SQLTask:SqlStatementSource="&#xA;Declare @Periodo_Produccion_Fichas INT, @FECHA date&#xA;SET @Periodo_Produccion_Fichas = (Select MAX(PERPRO) from AS400.HOST03.DWHSMPD.DFECPRO)&#xA;Set @FECHA = (SELECT (cast(GETDATE()  as datetime)))&#xA;&#xA;Insert into Consultas_dw.dbo.Notificaciones_Grillas_Trazabilidad_Fichas_Diario&#xA;(id_fecha, id_producto, id_plan_producto, grilla, ID_Notificacion)&#xA;select @FECHA as id_fecha, id_producto, id_plan_producto, grilla, 0 as ID_Notificacion&#xA;from h_trazabilidad_fichas traz&#xA;WHERE id_periodo_produccion = @Periodo_Produccion_Fichas and id_tipo_movimiento_trazabilidad = 1 and not exists (select id_producto, id_plan_producto, grilla&#xA;from D_GRILLAS a01 where a01.id_producto = traz.id_producto and traz.id_plan_producto = a01.id_plan_producto&#xA;and traz.grilla = a01.grilla) &#xA;and not exists (select id_producto, id_plan_producto, grilla&#xA;from Consultas_dw.dbo.Notificaciones_Grillas_Trazabilidad_Fichas_Diario a01 where a01.id_producto = traz.id_producto and traz.id_plan_producto = a01.id_plan_producto&#xA;and traz.grilla = a01.grilla and id_notificación = 1) &#xA;group by id_producto, id_plan_producto, grilla&#xA;&#xA;&#xA;----- Inserta las grillas &#xA;&#xA;---- Comprueba si existe alguna grilla&#xA;&#xA;select id_producto, id_plan_producto, grilla&#xA;into #grillas1&#xA;from h_trazabilidad_fichas traz&#xA;WHERE id_periodo_produccion = @Periodo_Produccion_Fichas and id_tipo_movimiento_trazabilidad = 1 and not exists (select id_producto, id_plan_producto, grilla&#xA;from d_grillas a01 where a01.id_producto = traz.id_producto and traz.id_plan_producto = a01.id_plan_producto&#xA;and traz.grilla = a01.grilla) &#xA;group by id_producto, id_plan_producto, grilla&#xA;&#xA;&#xA;---- Inserta las grillas que falten en D_GRILLAS&#xA;&#xA;INSERT INTO [DW_SALUD].[dbo].[D_GRILLAS]&#xA;           ([id_producto]&#xA;           ,[id_plan_producto]&#xA;           ,[grilla]&#xA;           ,[de_grilla]&#xA;           ,[char_fecha_vig_desde]&#xA;           ,[char_fecha_vig_hasta]&#xA;           ,[id_con_copago]&#xA;           ,[fecha_vig_desde]&#xA;           ,[fecha_vig_hasta])&#xA;select &#xA;           N.id_producto&#xA;           ,N.id_plan_producto&#xA;           ,N.grilla&#xA;           ,'No Definida'&#xA;           ,'19000101'&#xA;           ,'19000101'&#xA;           ,'X'&#xA;           ,cast('19000101' as datetime)&#xA;           ,cast('19000101' as datetime)&#xA;from #grillas1 N&#xA;&#xA;&#xA;&#xA;---- Envio mail Consistencia Grillas&#xA;&#xA;IF (select COUNT(id_fecha) from Consultas_dw.dbo.Notificaciones_Grillas_Trazabilidad_Fichas_Diario&#xA;where id_fecha = @FECHA &#xA;and id_notificacion = 0 ) &lt;&gt; 0&#xA;&#xA;Begin&#xA;&#xA;EXEC msdb.dbo.sp_send_dbmail&#xA;   @profile_name = 'Soporte MicroStrategy',&#xA;   @recipients = 'liliana.alassia@sancorsalud.com.ar;juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;   @subject = 'Trazabilidad de fichas - Control de Consistencia',&#xA;   @body = 'Buenos Días,&#xA;   &#xA;   En esta oportunidad enviamos el correo con el Control de Consistencia para Grillas.&#xA;&#xA;   Desde ya estamos a disposición,&#xA;&#xA;    Saludos&#xA;&#xA; Juan Francisco Trinchieri&#xA;&#xA; Planeamiento y Control de Gestión&#xA; SanCor Salud - Sede Central&#xA; Tel.: 03493-429500  Int. 3086&#xA; juanfrancisco.trinchieri@sancorsalud.com.ar&#xA;&#xA;&#xA;  Información Sobre el Estado - Grillas en Trazabilidad Fichas Diario&#xA;   ',&#xA;@query = 'Select id_producto, id_plan_producto, grilla from Consultas_dw.dbo.Notificaciones_Grillas_Trazabilidad_Fichas_Diario where&#xA;id_notificacion = 0  ',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;&#xA;&#xA;UPDATE Consultas_dw.dbo.Notificaciones_Grillas_Trazabilidad_Fichas_Diario SET id_notificacion = 1&#xA;where id_fecha = @FECHA &#xA;&#xA;END&#xA;&#xA;---Consistencia en Promotores&#xA;&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_promotor as ID,'ID_Promotor' AS CAMPO_ID , 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA;from h_trazabilidad_fichas&#xA;where id_promotor not in (select id_promotor from d_promotor &#xA;group by id_promotor)&#xA;and id_promotor not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Promotor')&#xA;&#xA;&#xA;--Consistencia en Sectores de Carga&#xA;&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_sector_carga ,'ID_Sector_Carga' AS CAMPO_ID , 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA; from h_trazabilidad_fichas&#xA;where id_sector_carga not in (select id_sector_carga from D_SECTOR_CARGA&#xA;group by id_sector_carga)&#xA;and id_sector_carga not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Sector_Carga')&#xA; &#xA;---- Inserta en la D_SECTOR_CARGA&#xA;&#xA;Insert into D_SECTOR_CARGA&#xA;(id_sector_carga, de_sector_carga)&#xA;select ID as id_sector_carga, 'RC-' +  convert(char, ID,5) as de_sector_carga &#xA;from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;where id_notificacion = 0 and CAMPO_ID = 'ID_Sector_Carga'&#xA;and ID not in (select distinct id_sector_carga from D_SECTOR_CARGA) &#xA;&#xA;&#xA;--Consistencia en Jefe de Equipo&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_jefe_equipo as ID,'ID_Jefe_Equipo' AS CAMPO_ID , 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA;  from h_trazabilidad_Fichas&#xA;where id_jefe_equipo not in (select id_jefe_equipo from d_jefe_equipo&#xA;group by id_jefe_equipo) &#xA;and id_jefe_equipo not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Jefe_Equipo')&#xA;&#xA; ---- Inserta en la D_JEFE_EQUIPO &#xA;&#xA;Insert into D_JEFE_EQUIPO&#xA;(id_jefe_equipo, de_jefe_equipo, id_zona_comarcal, id_posicion_relacionada, fecha_fin_vigencia)&#xA;select A.W09NAS  as id_jefe_equipo, P.Apellido + ' ' + P.Nombre as de_jefe_equipo&#xA;, 999 as id_zona_comarcal, 999 as id_posicion_relacionada, 0 as fecha_fin_vigencia&#xA;from H_TRAZABILIDAD_FICHAS JF&#xA;inner join HOST03.HOST03.SMPLIBD.M09FASE A on A.W09NAS = JF.id_jefe_equipo&#xA;inner join D_PERSONAS P on A.W09NPE = P.id_persona&#xA;where id_jefe_equipo not in (select distinct id_jefe_equipo from D_JEFE_EQUIPO)&#xA;and id_jefe_equipo  in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Jefe_Equipo' and id_notificación = 0)&#xA; group by A.W09NAS  , P.Apellido , P.Nombre&#xA;&#xA;&#xA;--Consistencia en Supervisor&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_supervisor, 'ID_Supervisor' AS CAMPO_ID , 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA; from h_trazabilidad_fichas&#xA;where id_supervisor not in (select id_supervisor from d_supervisor&#xA;group by id_supervisor)&#xA;and id_supervisor not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Supervisor')&#xA;&#xA;---- Inserta en la D_SUPERVISOR&#xA;&#xA;Insert into D_SUPERVISOR&#xA;(id_supervisor, de_supervisor, id_zona_comarcal, id_posicion_relacionada, fecha_fin_vigencia)&#xA;select A.W09NAS  as id_supervisor, P.Apellido + ' ' + P.Nombre as de_supervisor&#xA;, 999 as id_zona_comarcal, 999 as id_posicion_relacionada, 0 as fecha_fin_vigencia&#xA;from H_TRAZABILIDAD_FICHAS JF&#xA;inner join HOST03.HOST03.SMPLIBD.M09FASE A on A.W09NAS = JF.id_supervisor&#xA;inner join D_PERSONAS P on A.W09NPE = P.id_persona&#xA;where id_supervisor not in (select distinct id_supervisor from D_SUPERVISOR)&#xA;and id_supervisor  in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Supervisor' and id_notificación = 0)&#xA;  group by A.W09NAS  , P.Apellido , P.Nombre&#xA;&#xA;---- Consistencia en Datero&#xA;&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_datero, 'ID_Datero' AS CAMPO_ID , 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA; from h_trazabilidad_fichas&#xA;where id_datero not in (select id_datero from D_DATEROS&#xA;group by id_datero)&#xA;and id_datero not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Datero')&#xA;&#xA;---- Inserta en la D_DATEROS&#xA;&#xA;Insert into D_DATEROS&#xA;(id_datero, de_datero, id_zona_comarcal)&#xA;select id_datero, 'No definido' as de_datero, 999 as id_zona_comarcal&#xA;from H_TRAZABILIDAD_FICHAS JF&#xA;where id_datero not in (select distinct id_datero from D_DATEROS)&#xA;and id_datero  in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Datero' and id_notificación = 0)&#xA;  group by id_datero&#xA;&#xA;--Consistencia en Localidad&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_localidad_afiliado as ID , 'ID_Localidad_Afiliado' AS CAMPO_ID , 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA;from h_trazabilidad_fichas&#xA;where id_localidad_afiliado not in (select id_localidad from d_localidades&#xA;group by id_localidad)&#xA;and id_localidad_afiliado not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Localidad_Afiliado')&#xA;&#xA;--Consistencia en Entidad&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(id, CAMPO_ID, id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select distinct id_entidad as ID, 'ID_Entidad' AS CAMPO_ID, 0 as id_notificación, @FECHA AS FECHA_Notificación, 1 as cantidad_campos&#xA; from h_trazabilidad_fichas&#xA;where id_entidad not in (select id_entidad from d_entidades&#xA;group by id_entidad)&#xA;and id_entidad not in  (select distinct ID from&#xA; Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA; where CAMPO_ID = 'ID_Entidad')&#xA; &#xA;---- Envio mail si es un unico campo. &#xA;&#xA;IF (select count(ID) from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;where id_notificacion = 0 and 1 = cantidad_campos ) &lt;&gt; 0&#xA;&#xA;Begin&#xA;&#xA;EXEC msdb.dbo.sp_send_dbmail&#xA;   @profile_name = 'Soporte MicroStrategy',&#xA;   @recipients = 'liliana.alassia@sancorsalud.com.ar; juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;   @subject = 'Trazabilidad de fichas - Control de Consistencia',&#xA;   @body = 'Buenos Días,&#xA;   &#xA;   En esta oportunidad enviamos el correo con el Control de Consistencia en Trazabilidad de Fichas Diario.&#xA;   &#xA;   A modo de comentario el Campo_ID es el nombre que le corresponde al Campo &quot;ID&quot;. &#xA;&#xA;   Desde ya estamos a disposición,&#xA;&#xA;    Saludos&#xA;&#xA; Juan Francisco Trinchieri&#xA;&#xA; Planeamiento y Control de Gestión&#xA; SanCor Salud - Sede Central&#xA; Tel.: 03493-429500  Int. 3086&#xA; juanfrancisco.trinchieri@sancorsalud.com.ar&#xA;&#xA;&#xA;  Información Sobre el Estado - Campos Consistencia en Trazabilidad Fichas Diario&#xA;   ',&#xA;@query = 'Select ID, CAMPO_ID from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario where&#xA;id_notificacion = 0 and  1 = cantidad_campos ',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;&#xA;&#xA;UPDATE Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario SET id_notificacion = 1&#xA;where cantidad_campos = 1&#xA;&#xA;END&#xA;&#xA;---- Consistencia en Grupo de Afinidad&#xA;&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(ID,ID_2, CAMPO_ID, CAMPO_ID_2,id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select id_empresa as ID, id_tipo_entidad as ID_2, 'ID_Empresa' AS CAMPO_ID, 'ID_Tipo_Entidad' AS CAMPO_ID_2 ,0 as id_notificación, @FECHA AS FECHA_Notificación, 2 as cantidad_campos&#xA;from h_trazabilidad_fichas H&#xA;where not exists (select id_empresa,id_tipo_entidad from d_empresas D where &#xA;D.id_empresa = H.id_empresa and D.id_tipo_entidad = H.id_tipo_entidad)&#xA;and not exists (select ID, ID_2 from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario D where &#xA;D.ID = H.id_empresa and D.ID_2 = H.id_tipo_entidad and CAMPO_ID = 'ID_Empresa')&#xA;group by id_empresa, id_tipo_entidad&#xA;&#xA;---- Consistencia en Empresa que factura&#xA;&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(ID,ID_2, CAMPO_ID, CAMPO_ID_2,id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select id_empresa_factura as ID, id_tipo_entidad_factura as ID_2, 'ID_Empresa_Factura' AS CAMPO_ID, 'ID_Tipo_Entidad_Factura' AS CAMPO_ID_2 ,0 as id_notificación, @FECHA AS FECHA_Notificación, 2 as cantidad_campos&#xA;from h_trazabilidad_fichas H&#xA;where not exists (select id_empresa,id_tipo_entidad from d_empresas D where &#xA;D.id_empresa = H.id_empresa_factura and D.id_tipo_entidad = H.id_tipo_entidad_factura)&#xA;and not exists (select ID, ID_2 from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario D where &#xA;D.ID = H.id_empresa_factura and D.ID_2 = H.id_tipo_entidad_factura and CAMPO_ID = 'ID_Empresa_Factura')&#xA;group by id_empresa_factura, id_tipo_entidad_factura&#xA;&#xA;---- Consistencia en Plan Producto y Producto&#xA;&#xA;Insert into Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;(ID,ID_2, CAMPO_ID, CAMPO_ID_2,id_notificación, FECHA_Notificación, cantidad_campos)&#xA;select H.id_plan_producto as ID, H.id_producto as ID_2, 'ID_Plan_Producto' AS CAMPO_ID, 'ID_Producto' AS CAMPO_ID_2 ,0 as id_notificación, @FECHA AS FECHA_Notificación, 2 as cantidad_campos&#xA;from H_TRAZABILIDAD_FICHAS H&#xA;where not exists (select id_plan_producto,id_producto from D_PLANES D where &#xA;D.id_plan_producto = H.id_plan_producto and D.id_producto = H.id_producto)&#xA;and not exists (select ID, ID_2 from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario D where &#xA;D.ID = H.id_plan_producto and D.ID_2 = H.id_producto&#xA;and campo_id_2 = 'ID_Producto') and H.id_periodo_produccion = @Periodo_Produccion_Fichas&#xA;group by id_plan_producto, id_producto&#xA;&#xA;&#xA;---- Envio mail si son 2 campos.&#xA;&#xA;IF (select count(ID) from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario&#xA;where id_notificacion = 0 and cantidad_campos = 2 ) &lt;&gt; 0&#xA;&#xA;Begin&#xA;&#xA;EXEC msdb.dbo.sp_send_dbmail&#xA;   @profile_name = 'Soporte MicroStrategy',&#xA;   @recipients = 'liliana.alassia@sancorsalud.com.ar; juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;   @subject = 'Trazabilidad de fichas - Control de Consistencia',&#xA;   @body = 'Buenos Días,&#xA;   &#xA;   En esta oportunidad enviamos el correo con el Control de Consistencia en Trazabilidad de Fichas Diario.&#xA;   &#xA;   A modo de comentario el Campo_ID es el nombre que le corresponde al Campo &quot;ID&quot;. &#xA;&#xA;   En el caso de Campo_ID_2 es el nombre que le corresponde al Campo &quot;ID_2&quot;. &#xA;   &#xA;   Desde ya estamos a disposición,&#xA;&#xA;    Saludos&#xA;&#xA; Juan Francisco Trinchieri&#xA;&#xA; Planeamiento y Control de Gestión&#xA; SanCor Salud - Sede Central&#xA; Tel.: 03493-429500  Int. 3086&#xA; juanfrancisco.trinchieri@sancorsalud.com.ar&#xA;&#xA;&#xA;  Información Sobre el Estado - Campos Consistencia en Trazabilidad Fichas Diario&#xA;   ',&#xA;@query = 'Select ID, CAMPO_ID, ID_2, CAMPO_ID_2 from Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario where&#xA;id_notificacion = 0  and cantidad_campos = 2',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;&#xA;&#xA;UPDATE Consultas_Dw.dbo.Notificaciones_Consistencia_Trazabilidad_Fichas_Diario SET id_notificacion = 1&#xA;where cantidad_campos = 2&#xA;&#xA;END&#xA;&#xA;&#xA;---- Inserta la combinación de id_plan_producto e id_producto&#xA;&#xA;Insert into Consultas_dw.dbo.Notificaciones_Consistencia_D_PLANES&#xA;( id_plan_producto, id_producto,  id_notificacion, id_periodo_produccion, FECHA_Notificación)&#xA;select distinct id_plan_producto, H.id_producto, 0 as id_notificacion, id_periodo_produccion, @FECHA as FECHA_Notificación&#xA; from H_TRAZABILIDAD_FICHAS H with (nolock)&#xA; inner join D_PRODUCTOS P with (nolock) ON H.id_producto = P.id_producto&#xA; where  exists (select id_plan_producto, id_producto from D_PLANES D &#xA;               where D.id_plan_producto = H.id_plan_producto and H.id_producto = D.id_producto and id_SubRubro_ley = 0) &#xA; and id_periodo_produccion = @Periodo_Produccion_Fichas&#xA; and id_clase_producto = 'S'&#xA;&#xA;&#xA;---- Inserta Un nuevo Plan / producto en D_PLANES ( recordar de actualizar la descripción)&#xA;&#xA;&#x9;INSERT INTO D_PLANES&#xA;&#x9;(id_producto, id_plan_producto, de_planes, de_plan_reducida, orden_plan, id_plan_activo, visualizacion_web, Id_Plan_Agrupado, Id_Rubro_Salud, Id_Tipo_Planes, Id_Subrubro_Ley, Id_Plan_Agrupado_Convenio, Id_SubRubro_Ley_Agrupado)&#xA;&#x9;SELECT DISTINCT id_producto, id_plan_producto, 'No definido' as de_planes, ' ' as de_plan_reducida, 999 as orden_plan, 'NO' as id_plan_activo, 0 as visualizacion_web, 999 as Id_Plan_Agrupado, ' ' as Id_Rubro_Salud, null as Id_Tipo_Planes, 0 as Id_Subrubro_Ley, 0 as Id_Plan_Agrupado_Convenio, 0 as Id_SubRubro_Ley_agrupado&#xA;&#x9;from H_TRAZABILIDAD_FICHAS a11&#xA;&#x9;where not EXISTS&#xA;&#x9;(select * from d_planes a12 where a11.id_producto = a12.id_producto&#xA;&#x9;and a11.id_plan_producto = a12.id_plan_producto)&#x9; &#xA;&#x9;and id_periodo_produccion = @Periodo_Produccion_Fichas&#xA;&#xA;&#xA;IF (select count(id_plan_producto) from Consultas_Dw.dbo.Notificaciones_Consistencia_D_PLANES&#xA;where id_notificacion = 0) &lt;&gt; 0&#xA;&#xA;Begin&#xA;&#xA;EXEC msdb.dbo.sp_send_dbmail&#xA;   @profile_name = 'Soporte MicroStrategy',&#xA;   @recipients = 'liliana.alassia@sancorsalud.com.ar;juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;   @subject = 'Trazabilidad de fichas - Control de Consistencia en D_PLANES',&#xA;   @body = 'Buenos Días,&#xA;   &#xA;   En esta oportunidad enviamos el correo con el Control de Consistencia en D_PLANES para Trazabilidad de Fichas Diario.&#xA;   &#xA;   A modo de comentario se muestran la combinacion de id_plan_producto e id_producto para el periodo vigente de producción fichas , que el id_SubRubro_ley = 0 y el id_clase_producto = &quot;S&quot;&#xA;&#xA;  Recordar actualizar la descripción si alguno de los nuevos planes agregados esta como &quot;No definido&quot;, sacar la información del nombre en AS400.&#xA;   &#xA;   Desde ya estamos a disposición,&#xA;&#xA;    Saludos&#xA;&#xA; Juan Francisco Trinchieri&#xA;&#xA; Planeamiento y Control de Gestión&#xA; SanCor Salud - Sede Central&#xA; Tel.: 03493-429500  Int. 3086&#xA; juanfrancisco.trinchieri@sancorsalud.com.ar&#xA;&#xA;&#xA;  Información Sobre el Estado - Campos Consistencia en Trazabilidad Fichas Diario&#xA;   ',&#xA;@query = 'Select id_plan_producto, id_producto,  id_periodo_produccion from Consultas_Dw.dbo.Notificaciones_Consistencia_D_PLANES where&#xA;id_notificacion = 0  ',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;    &#xA; UPDATE Consultas_Dw.dbo.Notificaciones_Consistencia_D_PLANES SET id_notificacion = 1&#xA; &#xA;END&#xA;&#xA;&#xA;/* Control de Consistencia Apellido en D_PERSONAS_TRAZABILIDAD */&#xA;&#xA;/* Se agregan los nuevos casos para notificar */&#xA;&#xA;Insert into Consultas_dw.dbo.Consistencia_APELLIDO_TRAZABILIDAD &#xA;(id_ficha, DNI, apellido, id_notificado)&#xA;select H.id_ficha, D.nro_documento as DNI, de_apellido_titular as apellido, 0 as id_notificado &#xA;from H_TRAZABILIDAD_FICHAS H&#xA;Inner Join D_PERSONAS_TRAZABILIDAD D ON  D.id_ficha = H.id_ficha&#xA;where H.id_periodo_produccion = @Periodo_Produccion_Fichas&#xA;and de_apellido_titular = 'A'&#xA;group by H.id_ficha, D.nro_documento , de_apellido_titular&#xA;order by de_apellido_titular&#xA;&#xA;/* Envia Mail si existe algun caso nuevo para notificar */&#xA;&#xA;IF (select count(id_notificado) from Consultas_dw.dbo.Consistencia_APELLIDO_TRAZABILIDAD&#xA;where id_notificado = 0) &gt; 0&#xA;Begin&#xA;&#xA;EXEC msdb.dbo.sp_send_dbmail&#xA;   @profile_name = 'Soporte MicroStrategy',&#xA;   @recipients = 'liliana.alassia@sancorsalud.com.ar; juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;   @subject = 'Trazabilidad de fichas - Control de Consistencia D_PERSONAS_TRAZABILIDAD',&#xA;   @body = 'Buenos Días,&#xA;   &#xA;    En esta oportunidad enviamos el correo con el Control de Consistencia en D_PERSONAS_TRAZABILIDAD para Trazabilidad de Fichas Diario.&#xA;   &#xA;   A modo de comentario se muestra la información con las siguientes referencias:&#xA;- id_ficha es la misma que H_TRAZABILIDAD_FICHAS para el periodo de produccion vigente.&#xA;- DNI es el nro_documento que aparece en D_PERSONAS_TRAZABILIDAD para dicha ficha.&#xA;- apellido es el A como se muestra en D_PERSONAS_TRAZABILIDAD.&#xA;   &#xA;   Desde ya estamos a disposición,&#xA;&#xA;    Saludos&#xA;&#xA; Juan Francisco Trinchieri&#xA;&#xA; Planeamiento y Control de Gestión&#xA; SanCor Salud - Sede Central&#xA; Tel.: 03493-429500  Int. 3086&#xA; juanfrancisco.trinchieri@sancorsalud.com.ar&#xA;&#xA;   ',&#xA;@query = 'select id_ficha, DNI, apellido from Consultas_dw.dbo.Consistencia_APELLIDO_TRAZABILIDAD where&#xA;id_notificado = 0 &#xA;group by id_ficha, DNI, apellido&#xA; ',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;&#xA;&#xA;UPDATE Consultas_dw.dbo.Consistencia_APELLIDO_TRAZABILIDAD SET id_notificado = 1&#xA;&#xA;END&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Esta sección CDATA contiene la información de diseño del paquete. Esta sección incluye información como, por ejemplo, las coordenadas (x,y), el ancho y el alto.-->
<!--Si edita manualmente esta sección y comete un error, puede eliminarlo. -->
<!--El paquete podrá cargarse normalmente, pero se perderá la información de diseño anterior y el diseñador reorganizará los elementos automáticamente en la superficie de diseño.-->
<Objects
  Version="8">
  <!--Cada uno de los nodos siguientes contiene propiedades que no afectan al comportamiento en tiempo de ejecución.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="392,41.6"
          Id="Package\Envio mail --- Consistencia y Actualización Tablas de Dimensión"
          TopLeft="105,125" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>