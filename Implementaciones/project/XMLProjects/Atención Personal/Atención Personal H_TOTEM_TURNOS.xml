<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="1/29/2018 9:17:15 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\jtrinchier"
  DTS:DTSID="{31AAA568-1DA2-4D29-A6D4-7195AFE6ABEA}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Atención Personal H_TOTEM_TURNOS"
  DTS:PackageType="5"
  DTS:VersionBuild="71"
  DTS:VersionGUID="{5BE28C05-DC73-401E-B27A-A3C5FEBE1143}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{83499D50-01F7-46F1-84FD-C81C197ED2F8}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{C934984E-89D3-4474-9B6A-A3427822F636}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="fecha_max">
      <DTS:VariableValue
        DTS:DataType="7">8/26/2019 9:28:57 AM</DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{83499D50-01F7-46F1-84FD-C81C197ED2F8}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Actualiza AUX_H_TOTEM_TURNOS"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{206F5BB0-DB49-45CE-8CC0-66A9EFB79312}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza AUX_H_TOTEM_TURNOS"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="DECLARE @FechaMax DATETIME&#xA;&#xA;DELETE H_TOTEM_TURNOS where id_periodo = dbo.DevuelvePeriodo(GETDATE())&#xA;&#xA;SET @FechaMax = (SELECT MAX(fecha_inicio_turno) FROM H_TOTEM_TURNOS)&#xA;&#xA;---- Actualiza AUX_H_TOTEM_TURNOS&#xA;&#xA;TRUNCATE TABLE AUX_H_TOTEM_TURNOS&#xA;&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED&#xA;INSERT INTO AUX_H_TOTEM_TURNOS&#xA;SELECT    DW_SALUD.dbo.DevuelvePeriodo(M.action_time), -- Periodo&#xA;        M.turn_id, -- Turno&#xA;        0, -- Movimiento&#xA;        0, -- Usuario,&#xA;        0, -- Subtramite&#xA;        0, -- Puesto,&#xA;        NULL, -- Estado&#xA;        M.branch_id,-- Car&#xA;        P.id_posicion, -- Posicion&#xA;         dbo.RemoverChars(MAX(LEFT(turn_dni, 8)))    , -- DNI&#xA;        MIN(M.action_time), -- Fecha inicio&#xA;        NULL, -- Fecha llamada&#xA;        MAX(M.action_time), -- Fecha Fin&#xA;        NULL as id_empresa_legajo_gerente,&#xA;&#x9;&#x9;NULL as id_legajo_gerente,&#xA;&#x9;&#x9;NULL as id_empresa_legajo_jefe_regional,&#xA;&#x9;&#x9;NULL as id_legajo_jefe_regional,&#xA;&#x9;&#x9;NULL as id_empresa_legajo_supervisor_zonal,&#xA;&#x9;&#x9;NULL as id_legajo_supervisor_zonal,&#xA;&#x9;&#x9;NULL as id_empresa_legajo_responsable_car,&#xA;&#x9;&#x9;NULL as id_legajo_responsable_car,&#xA;&#x9;&#x9;NULL as id_empresa_legajo_oficial_atencion,&#xA;&#x9;&#x9;NULL as id_legajo_oficial_atencion,&#xA;        MAX(wait_total_time),-- Tiempo Espera&#xA;        MAX(attention_total_time), -- Tiempo atención&#xA;        MAX(wait_total_time)/60, -- Tiempo espera en minutos&#xA;        MAX(attention_total_time)/60, -- Tiempo atención en minutos&#xA;        1 As cant_turnos, -- Cantidad de turnos&#xA;        0 as cant_turnos_abandono, -- Cantidad de turnos abandono.       &#xA;        0, -- Marca tramite asociado&#xA;        NULL, -- Marca Totem&#xA;        0, -- Persona&#xA;&#x9;&#x9;0, -- Producto&#xA;&#x9;&#x9;0, -- SubProducto&#xA;&#x9;&#x9;'99999', -- Plan Producto&#xA;&#x9;&#x9;9 --Compañia&#xA;        FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud]  M WITH (NOLOCK)&#xA;&#x9;&#x9;INNER JOIN D_POSICION_BRANCH_TURNOS P ON (M.branch_id=P.id_totem)&#xA;        WHERE (queue_id IN (SELECT id_tramite_turno FROM D_TRAMITES_TURNOS WHERE id_origen_turno IN (1, 2)) or company_id = 186)&#xA;&#x9;&#x9;AND action_time &gt; @FechaMax&#xA;GROUP BY DW_SALUD.dbo.DevuelvePeriodo(M.action_time),&#xA;        M.turn_id,&#xA;        M.branch_id,&#xA;        P.id_posicion&#xA;&#xA;-- Hay turnos que tiene derivaciones hacia otros CAR, lo que no es correcto y nos duplica la clave. Por lo tanto lo borramos.&#xA;DELETE AUX_H_TOTEM_TURNOS&#xA;WHERE id_turno in (SELECT id_turno FROM AUX_H_TOTEM_TURNOS GROUP BY id_turno&#xA;HAVING COUNT(id_turno)&gt;1)&#xA;&#xA;-- Actualiza DNI en 0 cuando es NULL.&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET nro_documento = 0&#xA;WHERE nro_documento IS NULL&#xA;&#xA;-- Busca el id de movimiento (id unico en la tabla qmovements) donde el usuario no sea NULL.&#xA;-- Si el usuario es NULL es porque solo se registro el ingreso y no existen otros datos de importancia (tramite, sutramite, etc).&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_movimiento = idMAX&#xA;FROM AUX_H_TOTEM_TURNOS T&#xA;INNER JOIN (SELECT turn_id, MAX(id) AS idMAX&#xA;            FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] WITH (NOLOCK)&#xA;            WHERE user_id IS NOT NULL AND  (queue_id IN (SELECT id_tramite_turno FROM D_TRAMITES_TURNOS WHERE id_origen_turno IN (1, 2)) or company_id = 186) AND action_time &gt;= @FechaMax &#xA;            GROUP BY turn_id) AS Q&#xA;ON (T.id_turno=Q.turn_id)&#xA;&#xA;&#xA;-- Con el id_movimiento obtenido anteriormente se obtiene usuario, puesto y turno.&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_usuario_turno = u_user_id&#xA;FROM AUX_H_TOTEM_TURNOS T&#xA;INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud]  Q WITH (NOLOCK) ON (T.id_movimiento=Q.id)&#xA;INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qusers_sancorsalud] U WITH (NOLOCK) ON (Q.user_id=U.id)&#xA;where  action_time &gt;= @FechaMax &#xA;&#xA;/* Actualiza Estado Atendido (1) */&#xA;&#xA;-- Donde el estado del turno en la qmovements sea finalizado, le pega la marca del estado en la AUX.&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_estado_turno = 1&#xA;FROM AUX_H_TOTEM_TURNOS T INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] Q WITH (NOLOCK) ON (T.id_turno=Q.turn_id)&#xA;WHERE action_text IN ('TIPIFICADO Y FINALIZADO', 'FINALIZACION','FINALIZACION POR REINICIO' ) AND action_time &gt;= @FechaMax &#xA;AND ( id_estado_turno is null)&#xA;&#xA;/* Actualiza Estado Abandono (2) */&#xA;&#xA; --Se actualiza en 1 la cantidad de turnos donde el cliente no se presenta.&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET cant_turnos_abandono = 1,&#xA;    id_estado_turno = 2&#xA;FROM AUX_H_TOTEM_TURNOS T INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] Q WITH (NOLOCK) ON (T.id_turno=Q.turn_id)&#xA;WHERE Q.action_text in ( 'NO PRESENTA', 'NO PRESENTA POR REINICIO') AND action_time &gt;= @FechaMax &#xA;and (id_estado_turno &lt;&gt; 1 or id_estado_turno is null)&#xA;&#xA;/* Actualiza Estado Llamado Directo (3) */&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_estado_turno = 3&#xA;FROM AUX_H_TOTEM_TURNOS T INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] Q WITH (NOLOCK) ON (T.id_turno=Q.turn_id)&#xA;WHERE action_text IN ('LLAMADO DIRECTO')  AND action_time &gt;= @FechaMax &#xA;and id_estado_turno not in (2)&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_tramite_turno = M.queue_id&#xA;FROM AUX_H_TOTEM_TURNOS T&#xA;INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] M WITH (NOLOCK) ON (T.id_turno=M.turn_id)&#xA;where  action_time &gt;= @FechaMax &#xA;&#xA;-- Actualiza los tiempos en 0 cuando son NULL.&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET tiempo_atencion = 0&#xA;WHERE tiempo_atencion IS NULL&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET tiempo_espera_cola = 0&#xA;WHERE tiempo_espera_cola IS NULL&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET tiempo_atencion_minutos = 0&#xA;WHERE tiempo_atencion_minutos IS NULL&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET tiempo_espera_cola_minutos = 0&#xA;WHERE tiempo_espera_cola_minutos IS NULL&#xA;&#xA;-- Existen turnos que tienen un solo registro, es decir, el ingreso. No se sabe como siguieron, si abandonaron, fueron atendidos o que pasó realmente. Por lo tanto&#xA;-- estos turnos no serán tenidos en cuenta y los borra en el siguiente script:&#xA;&#xA;DELETE AUX_H_TOTEM_TURNOS&#xA;WHERE id_turno IN (&#xA;SELECT turn_id FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] WITH (NOLOCK)&#xA;WHERE branch_id IN (SELECT DISTINCT id_totem FROM D_POSICION_BRANCH_TURNOS)&#xA;and  action_time &gt;= @FechaMax &#xA;GROUP BY turn_id&#xA;HAVING COUNT(turn_id)=1)&#xA;&#xA;-- Se eliminan los registros que no sean abandono y que no tengan subtramite, definido por Muriel el 09/2017.&#xA;&#xA;DELETE AUX_H_TOTEM_TURNOS WHERE id_estado_turno &lt;&gt; 2 and id_tramite_turno = 0&#xA;&#xA;---- Borra los turnos que se iniciaron un periodo y finalizaron el siguiente generando error en el insert a la H_TOTEM_TURNOS&#xA;&#xA;DELETE AUX_H_TOTEM_TURNOS WHERE id_turno IN (&#xA;SELECT id_turno FROM AUX_H_TOTEM_TURNOS&#xA;group by id_turno&#xA;having Count(distinct id_periodo) &gt; 1  )&#xA;&#xA;/* Actualiza id_persona */&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS &#xA;SET id_persona = D.id_persona&#xA;FROM AUX_H_TOTEM_TURNOS A&#xA;INNER JOIN D_PERSONAS D ON A.nro_documento = D.Nro_documento&#xA;inner join H_COMER_STOCK_AFILIA H ON H.id_persona = D.id_persona&#xA;&#xA;/* Actualiza campos de asociados ( id_producto, id_subproducto, id_plan_producto) */&#xA;&#xA;---- Busca para el mismo periodo tanto en Totem turnos como Stock &#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_producto = S.id_producto,&#xA;&#x9;id_subproducto = S.id_subproducto,&#xA;&#x9;id_plan_producto = S.id_plan_producto&#xA;FROM AUX_H_TOTEM_TURNOS A &#xA;INNER JOIN H_COMER_STOCK_AFILIA S ON (S.id_periodo=A.id_periodo AND S.id_persona=A.id_persona)&#xA;&#xA;---- Si no encuentra en el paso anterior, busca para el maximo periodo que estuvo en stock la persona&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_producto = S.id_producto,&#xA;&#x9;id_subproducto = S.id_subproducto,&#xA;&#x9;id_plan_producto = S.id_plan_producto&#xA;FROM AUX_H_TOTEM_TURNOS A INNER JOIN H_COMER_STOCK_AFILIA S  ON (S.id_persona=A.id_persona)&#xA;WHERE S.id_periodo = (SELECT MAX(id_periodo) FROM H_COMER_STOCK_AFILIA X WHERE X.id_persona=S.id_persona)&#xA;AND A.id_plan_producto IS NULL &#xA;&#xA;/* Actualización id_compania en AUX_H_TOTEM_TURNOS */&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;set id_compania = RL.id_compania&#xA;FROM AUX_H_TOTEM_TURNOS A&#xA;INNER JOIN D_PLANES PL ON (A.id_producto = PL.id_producto AND A.id_plan_producto = PL.id_plan_producto)&#xA;INNER JOIN D_SUBRUBRO_LEY SL ON (SL.Id_SubRubro_Ley = PL.id_SubRubro_ley)&#xA;INNER JOIN D_RUBRO_LEY RL ON (RL.Id_Rubro_ley = SL.id_Rubro_Ley)&#xA;&#xA;&#xA;-- Actualiza AUX_H_TOTEM_TURNOS por Supervisor.&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_empresa_legajo_gerente = H.id_empresa_legajo_gerente,&#xA;id_legajo_gerente =  H.id_legajo_gerente,&#xA;id_empresa_legajo_jefe_regional = H.id_empresa_legajo_jefe_regional,&#xA;id_legajo_jefe_regional = H.id_legajo_jefe_regional,&#xA;id_empresa_legajo_supervisor_zonal =  H.id_empresa_legajo_supervisor_zonal,&#xA;id_legajo_supervisor_zonal = H.id_legajo_supervisor_zonal,&#xA;id_empresa_legajo_responsable_car = 'F/D',&#xA;id_legajo_responsable_car = 0,&#xA;id_empresa_legajo_oficial_atencion ='F/D',&#xA;id_legajo_oficial_atencion = 0&#xA;from AUX_H_TOTEM_TURNOS T&#xA;inner join D_USUARIOS_TURNOS U on U.id_usuario_turno = T.id_usuario_turno&#xA;inner join D_PERSONAS_CASCADA_ATENCION P on P.email_usuario_turno = U.email_usuario_turno &#xA;inner join H_CASCADA_ATENCION H on H.id_empresa_legajo_supervisor_zonal = P.id_empresa_legajo&#xA;and H.id_legajo_supervisor_zonal = P.id_legajo&#xA;and T.id_periodo = H.id_periodo&#xA;&#xA;-- Actualiza AUX_H_TOTEM_TURNOS por Rsponsable.&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_empresa_legajo_gerente = h.id_empresa_legajo_gerente,&#xA;id_legajo_gerente =  h.id_legajo_gerente,&#xA;id_empresa_legajo_jefe_regional = h.id_empresa_legajo_jefe_regional,&#xA;id_legajo_jefe_regional = h.id_legajo_jefe_regional,&#xA;id_empresa_legajo_supervisor_zonal =  h.id_empresa_legajo_supervisor_zonal,&#xA;id_legajo_supervisor_zonal = h.id_legajo_supervisor_zonal,&#xA;id_empresa_legajo_responsable_car = h.id_empresa_legajo_responsable_car,&#xA;id_legajo_responsable_car = h.id_legajo_responsable_car,&#xA;id_empresa_legajo_oficial_atencion = 'F/D',&#xA;id_legajo_oficial_atencion =  0&#xA;from AUX_H_TOTEM_TURNOS T&#xA;inner join D_USUARIOS_TURNOS U on U.id_usuario_turno = T.id_usuario_turno&#xA;inner join D_PERSONAS_CASCADA_ATENCION P on P.email_usuario_turno = U.email_usuario_turno &#xA;inner join H_CASCADA_ATENCION H on H.id_empresa_legajo_responsable_car = p.id_empresa_legajo&#xA;and h.id_legajo_responsable_car = p.id_legajo&#xA;and T.id_periodo = H.id_periodo&#xA;&#xA;-- Actualiza H_TOTEM_TURNOS por Rsponsable.&#xA;&#xA;UPDATE AUX_H_TOTEM_TURNOS&#xA;SET id_empresa_legajo_gerente = H.id_empresa_legajo_gerente,&#xA;id_legajo_gerente =  H.id_legajo_gerente,&#xA;id_empresa_legajo_jefe_regional = H.id_empresa_legajo_jefe_regional,&#xA;id_legajo_jefe_regional = H.id_legajo_jefe_regional,&#xA;id_empresa_legajo_supervisor_zonal =  H.id_empresa_legajo_supervisor_zonal,&#xA;id_legajo_supervisor_zonal = H.id_legajo_supervisor_zonal,&#xA;id_empresa_legajo_responsable_car = H.id_empresa_legajo_responsable_car,&#xA;id_legajo_responsable_car = H.id_legajo_responsable_car,&#xA;id_empresa_legajo_oficial_atencion = H.id_empresa_legajo_oficial_atencion,&#xA;id_legajo_oficial_atencion =  H.id_legajo_oficial_atencion&#xA;from AUX_H_TOTEM_TURNOS T&#xA;inner join D_USUARIOS_TURNOS U on U.id_usuario_turno = T.id_usuario_turno&#xA;inner join D_PERSONAS_CASCADA_ATENCION P on P.email_usuario_turno = U.email_usuario_turno &#xA;inner join H_CASCADA_ATENCION H on H.id_empresa_legajo_oficial_atencion = P.id_empresa_legajo&#xA;and H.id_legajo_oficial_atencion = P.id_legajo&#xA;and T.id_periodo = H.id_periodo&#xA;&#xA;--- Actualiza campos en null AUX_H_TOTEM_TURNOS con valores por defecto para Gerente&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_empresa_legajo_gerente  = 'F/D'&#xA;from AUX_H_TOTEM_TURNOS where id_empresa_legajo_gerente is null&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_legajo_gerente  = 0&#xA;from AUX_H_TOTEM_TURNOS where id_legajo_gerente is null&#xA;&#xA;--- Actualiza campos en null AUX_H_TOTEM_TURNOS con valores por defecto para Jefe Regional&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_empresa_legajo_jefe_regional  = 'F/D'&#xA;from AUX_H_TOTEM_TURNOS where id_empresa_legajo_jefe_regional is null&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_legajo_jefe_regional  = 0&#xA;from AUX_H_TOTEM_TURNOS where id_legajo_jefe_regional is null&#xA;&#xA;--- Actualiza campos en null AUX_H_TOTEM_TURNOS con valores por defecto para Supervisor Zonal&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_empresa_legajo_supervisor_zonal  = 'F/D'&#xA;from AUX_H_TOTEM_TURNOS where id_empresa_legajo_supervisor_zonal is null&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_legajo_supervisor_zonal  = 0&#xA;from AUX_H_TOTEM_TURNOS where id_legajo_supervisor_zonal is null&#xA;&#xA;--- Actualiza campos en null AUX_H_TOTEM_TURNOS con valores por defecto para Responsable CAR&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_empresa_legajo_responsable_car  = 'F/D'&#xA;from AUX_H_TOTEM_TURNOS where id_empresa_legajo_responsable_car is null&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_legajo_responsable_car  = 0&#xA;from AUX_H_TOTEM_TURNOS where id_legajo_responsable_car is null&#xA;&#xA;--- Actualiza campos en null AUX_H_TOTEM_TURNOS con valores por defecto para Oficial Atención&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_empresa_legajo_oficial_atencion  = 'F/D'&#xA;from AUX_H_TOTEM_TURNOS where id_empresa_legajo_oficial_atencion is null&#xA;&#xA;UPDATE  AUX_H_TOTEM_TURNOS  SET id_legajo_oficial_atencion  = 0&#xA;from AUX_H_TOTEM_TURNOS where id_legajo_oficial_atencion is null&#xA;&#xA;&#xA;-- A pedido de Muriel, se eliminan los 3 usuarios de Ramos Mejía que creó para la capacitación. Mail 3/04/2018&#xA;-- A pedido de Lucy el usuario 302 debemos mostrarlo a partir de febrero 2020 ya que es un usuario de Santa Fe.&#xA;&#xA;DELETE AUX_H_TOTEM_TURNOS WHERE id_usuario_turno IN (301, 303)&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::fecha_max"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="7"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Actualiza AUX_H_TRAMITES_TURNOS"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{9F6C8E65-C223-4765-A49F-2E50EF0DB5FB}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza AUX_H_TRAMITES_TURNOS"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="DECLARE @FechaMax DATETIME&#xA;SET @FechaMax = ?&#xA;&#xA;----Empieza la carga del detalle. El detalle va a contener los mismos turnos que la cabecera (script de arriba) pero con todos los trámites que pasaron por ahí.&#xA;TRUNCATE TABLE AUX_H_TRAMITES_TURNOS&#xA;&#xA;-- Inserta en la auxiliar los nuevos tramites&#xA;SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED&#xA;INSERT INTO AUX_H_TRAMITES_TURNOS&#xA;SELECT    DW_SALUD.dbo.DevuelvePeriodo(M.action_time), -- Periodo&#xA;        M.turn_id,  -- Turno&#xA;        queue_id, -- Tramite,&#xA;        max (wait_time) / 60, -- Tiempo de espera,&#xA;        max(attention_time) / 60--Tiempo de atencion&#xA;        FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud] M WITH (NOLOCK)&#xA;        INNER JOIN [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qusers_sancorsalud] Q WITH (NOLOCK) on (Q.id=M.user_id)&#xA;WHERE queue_id IS NOT NULL and branch_id IN (SELECT DISTINCT id_totem FROM D_POSICION_BRANCH_TURNOS) &#xA;AND (queue_id IN (SELECT id_tramite_turno FROM D_TRAMITES_TURNOS WHERE id_origen_turno IN (1, 2)) or company_id = 186)&#xA;AND action_time &gt; @FechaMax&#xA;GROUP BY DW_SALUD.dbo.DevuelvePeriodo(M.action_time),&#xA;        M.turn_id,&#xA;        queue_id&#xA;&#xA;-- Si encuentra nulos los pone en 0&#xA;UPDATE AUX_H_TRAMITES_TURNOS&#xA;SET id_tramite_turno = 0&#xA;WHERE id_tramite_turno IS NULL&#xA;&#xA;UPDATE AUX_H_TRAMITES_TURNOS&#xA;SET tiempo_espera_cola_tramite = 0&#xA;WHERE tiempo_espera_cola_tramite IS NULL&#xA;&#xA;UPDATE AUX_H_TRAMITES_TURNOS&#xA;SET tiempo_atencion_tramite = 0&#xA;WHERE tiempo_atencion_tramite IS NULL&#xA;&#xA;-- Para que la información sea consistente tienen que quedar los mismos turnos en la cabecera que en el detalle. Como en la tabla anterior se eliminan los registros que no deben ir&#xA;-- se verifica que dentro del detalle no existan turnos que no estén en la H_TOTEM_TURNOS.&#xA;DELETE AUX_H_TRAMITES_TURNOS&#xA;WHERE id_turno NOT IN (SELECT id_turno FROM H_TOTEM_TURNOS)" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::fecha_max"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="7"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Actualiza marca totem"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{4829e7f0-a99c-42cc-b798-00b47f120821}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza marca totem"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (1, 4, 5, 7) and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (1, 4, 5, 7, 8, 9, 21, 23, 25, 74)&#xA;and id_periodo &gt;= 201712 and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (33)&#xA;and fecha_inicio_turno &gt;= '2018-03-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (31)&#xA;and fecha_inicio_turno &gt;= '2018-03-07 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (12)&#xA;and fecha_inicio_turno &gt;= '2018-03-08 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (2)&#xA;and fecha_inicio_turno &gt;= '2018-03-20 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (20)&#xA;and fecha_inicio_turno &gt;= '2018-03-21 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (16)&#xA;and fecha_inicio_turno &gt;= '2018-03-28 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (75)&#xA;and fecha_inicio_turno &gt;= '2018-04-10 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (3)&#xA;and fecha_inicio_turno &gt;= '2018-04-12 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (81)&#xA;and fecha_inicio_turno &gt;= '2018-04-17 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (57)&#xA;and fecha_inicio_turno &gt;= '2018-04-19 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (109)&#xA;and fecha_inicio_turno &gt;= '2018-05-07 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (122)&#xA;and fecha_inicio_turno &gt;= '2018-05-08 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (34)&#xA;and fecha_inicio_turno &gt;= '2018-05-09 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (107)&#xA;and fecha_inicio_turno &gt;= '2018-05-21 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (80)&#xA;and fecha_inicio_turno &gt;= '2018-05-28 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (38)&#xA;and fecha_inicio_turno &gt;= '2018-05-28 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (59)&#xA;and fecha_inicio_turno &gt;= '2018-05-29 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (121)&#xA;and fecha_inicio_turno &gt;= '2018-05-30 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (68)&#xA;and fecha_inicio_turno &gt;= '2018-05-31 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (115)&#xA;and fecha_inicio_turno &gt;= '2018-06-11 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (79)&#xA;and fecha_inicio_turno &gt;= '2018-06-11 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (19)&#xA;and fecha_inicio_turno &gt;= '2018-06-18 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (58)&#xA;and fecha_inicio_turno &gt;= '2018-06-18 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (17)&#xA;and fecha_inicio_turno &gt;= '2018-06-25 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (103)&#xA;and fecha_inicio_turno &gt;= '2018-07-16 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (116)&#xA;and fecha_inicio_turno &gt;= '2018-07-16 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (18)&#xA;and fecha_inicio_turno &gt;= '2018-07-23 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (92)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (27)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (86)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (117)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (45)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (71)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (36)&#xA;and fecha_inicio_turno &gt;= '2018-08-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (41)&#xA;and fecha_inicio_turno &gt;= '2018-08-08 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (83)&#xA;and fecha_inicio_turno &gt;= '2018-08-15 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (47)&#xA;and fecha_inicio_turno &gt;= '2018-08-15 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (22)&#xA;and fecha_inicio_turno &gt;= '2018-08-15 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (132)&#xA;and fecha_inicio_turno &gt;= '2018-08-15 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (112)&#xA;and fecha_inicio_turno &gt;= '2018-08-15 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (114)&#xA;and fecha_inicio_turno &gt;= '2018-08-15 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (129)&#xA;and fecha_inicio_turno &gt;= '2018-09-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (42)&#xA;and fecha_inicio_turno &gt;= '2018-09-06 00:00:00.000'and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (77)&#xA;and fecha_inicio_turno &gt;= '2018-09-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (49)&#xA;and fecha_inicio_turno &gt;= '2018-09-06 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (82)&#xA;and fecha_inicio_turno &gt;= '2018-09-20 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (78)&#xA;and fecha_inicio_turno &gt;= '2018-09-20 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (40)&#xA;and fecha_inicio_turno &gt;= '2018-09-20 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (85)&#xA;and fecha_inicio_turno &gt;= '2018-09-20 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (35)&#xA;and fecha_inicio_turno &gt;= '2018-09-20 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (37)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (123)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (84)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (72)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (56)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (111)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (110)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (15)&#xA;and fecha_inicio_turno &gt;= '2018-10-22 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (126)&#xA;and fecha_inicio_turno &gt;= '2018-11-09 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (89)&#xA;and fecha_inicio_turno &gt;= '2018-11-09 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (48)&#xA;and fecha_inicio_turno &gt;= '2018-11-09 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (46)&#xA;and fecha_inicio_turno &gt;= '2018-11-09 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (127)&#xA;and fecha_inicio_turno &gt;= '2018-11-09 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (39)&#xA;and fecha_inicio_turno &gt;= '2018-12-05 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (87)&#xA;and fecha_inicio_turno &gt;= '2018-12-05 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (108)&#xA;and fecha_inicio_turno &gt;= '2018-12-05 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (26)&#xA;and fecha_inicio_turno &gt;= '2018-12-05 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (139)&#xA;and fecha_inicio_turno &gt;= '2018-12-05 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (43)&#xA;and fecha_inicio_turno &gt;= '2018-12-19 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (44)&#xA;and fecha_inicio_turno &gt;= '2018-12-19 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (125)&#xA;and fecha_inicio_turno &gt;= '2018-12-19 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR LUJAN&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (135)&#xA;and fecha_inicio_turno &gt;= '2019-01-21 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR BELGRANO&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (105)&#xA;and fecha_inicio_turno &gt;= '2019-01-21 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;&#xA;---- CAR MONTEGRANDE&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (136)&#xA;and fecha_inicio_turno &gt;= '2019-01-23 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;&#xA;---- STAFF SALTA&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (185)&#xA;and fecha_inicio_turno &gt;= '2019-01-16 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;&#xA;---- CAR SAN LORENZO&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (502)&#xA;and fecha_inicio_turno &gt;= '2019-01-30 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;&#xA;---- CAR Tres Arroyos&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (184)&#xA;and fecha_inicio_turno &gt;= '2019-02-15 00:00:00.000' and id_marca_totem = 0 &#xA;&#xA;&#xA;---- CAR Cordoba Staff&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (141)&#xA;and fecha_inicio_turno &gt;= '2019-02-21 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR Staff Lujan Cuyo&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (137)&#xA;and fecha_inicio_turno &gt;= '2019-03-18 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR Cipolletti&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (143)&#xA;and fecha_inicio_turno &gt;= '2019-06-07 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR Tucuman STAFF &#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (144)&#xA;and fecha_inicio_turno &gt;= '2019-06-14 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR San Fernando&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (145)&#xA;and fecha_inicio_turno &gt;= '2019-06-25 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR CARCARAÑA &#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (503)&#xA;and fecha_inicio_turno &gt;= '2019-08-01 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- Car Staff Florencio Varela&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (506)&#xA;and fecha_inicio_turno &gt;= '2019-08-01 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR Lomas de Zamora&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (146)&#xA;and fecha_inicio_turno &gt;= '2019-08-19 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR M.T.Alvear Staff / Microcentro Staff &#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (147)&#xA;and fecha_inicio_turno &gt;= '2019-08-19 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CAR STAFF MORENO&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (508)&#xA;and fecha_inicio_turno &gt;= '2019-10-01 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- CENTRO MEDICO VITUS&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (130)&#xA;and fecha_inicio_turno &gt;= '2019-10-01 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;-- CAR VICENTE LOPEZ&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (507)&#xA;and fecha_inicio_turno &gt;= '2019-12-02 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;---- SAN JUSTO - STA FE&#xA;&#xA;UPDATE H_TOTEM_TURNOS &#xA;SET id_marca_totem = 1&#xA;WHERE id_posicion IN (758)&#xA;and fecha_inicio_turno &gt;= '2020-03-02 00:00:00.000' and id_marca_totem = 0&#xA;&#xA;--SELECT * FROM D_POSICION WHERE de_posicion LIKE '%NORTE%'" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Actualiza tablas de dimensión"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{1f3b6ad7-c5cb-44b0-8bfb-e3dd61c9c398}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza tablas de dimensión"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="--Si existe algún totem nuevo, o se modifica el que dice sancorsalud (actualmente no se usa) notifica por mail.&#xA;&#xA;IF (SELECT TOP 1 id FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[ubranches_sancorsalud] WHERE id NOT IN (SELECT id_totem FROM D_POSICION_BRANCH_TURNOS)&#xA;and district &lt;&gt; 'sancorsalud') IS NOT NULL AND DATEPART(DW, GETDATE())=2&#xA;begin &#xA; EXEC msdb.dbo.sp_send_dbmail&#xA;    @profile_name = 'Soporte Microstrategy',&#xA;    @recipients = 'nicolas.borio@sancorsalud.com.ar; matias.paludi@sancorsalud.com.ar ;juanfrancisco.trinchieri@sancorsalud.com.ar; liliana.alassia@sancorsalud.com.ar',&#xA;    @subject = 'Nuevo Totem',&#xA;    @body = 'Se agrega un nuevo Totem. Parametrizar la posición y agregar el id de totem en la tabla D_POSICION_BRANCH_TURNOS',&#xA;    @query = 'SELECT id, district FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[ubranches_sancorsalud] WHERE id NOT IN (SELECT id_totem FROM D_POSICION_BRANCH_TURNOS)&#xA;    and district &lt;&gt; ''sancorsalud''',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;end&#xA;&#xA;&#xA;DELETE D_TRAMITES_TURNOS&#xA;INSERT INTO D_TRAMITES_TURNOS&#xA;SELECT distinct ID, name, NULL, NULL&#xA;FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qqueues_sancorsalud] &#xA;where id IN (&#xA;SELECT DISTINCT queue_id FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qmovements_sancorsalud])&#xA;&#xA;--Envío por mail los nuevos trámites para ver si están bien parametrizados.&#xA;IF (SELECT TOP 1 id_tramite_turno FROM D_TRAMITES_TURNOS T&#xA;  WHERE NOT EXISTS (SELECT * FROM D_MOTIVOS_TURNOS D &#xA;  WHERE LTRIM(RIGHT(T.de_tramite_turno, LEN(T.de_tramite_turno)-CHARINDEX('- ', T.de_tramite_turno)))=D.de_motivo_turno)) IS NOT NULL&#xA;begin &#xA; EXEC msdb.dbo.sp_send_dbmail&#xA;    @profile_name = 'Soporte Microstrategy',&#xA;    @recipients = 'nicolas.borio@sancorsalud.com.ar; juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;    @subject = 'Nuevo Motivo/Tramite - Turnos Totem',&#xA;    @body = 'Se agrega un nuevo Tramite, lo cual generará un nuevo motivo. Verificar que&#xA;    este motivo tenga la parametrización correcta en la tabla de trámites.',&#xA;    @query = 'SELECT * FROM D_TRAMITES_TURNOS T&#xA;    WHERE NOT EXISTS (SELECT * FROM D_MOTIVOS_TURNOS D &#xA;    WHERE LTRIM(RIGHT(T.de_tramite_turno, LEN(T.de_tramite_turno)-CHARINDEX(''- '', T.de_tramite_turno)))=D.de_motivo_turno)',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;end&#xA;&#xA;--Mientras existan nuevos trámites, se tendrán que insertar en la D_MOTIVOS_TURNOS.&#xA;WHILE (SELECT TOP 1 id_tramite_turno FROM D_TRAMITES_TURNOS T&#xA;  WHERE NOT EXISTS (SELECT * FROM D_MOTIVOS_TURNOS D &#xA;  WHERE LTRIM(RIGHT(T.de_tramite_turno, LEN(T.de_tramite_turno)-CHARINDEX('- ', T.de_tramite_turno)))=D.de_motivo_turno)) IS NOT NULL&#xA;BEGIN&#xA; INSERT top (1) into D_MOTIVOS_TURNOS&#xA; SELECT (SELECT MAX(id_motivo_turno)+1 FROM D_MOTIVOS_TURNOS), T.de_tramite_turno&#xA; FROM D_TRAMITES_TURNOS T&#xA; WHERE NOT EXISTS (SELECT * FROM D_MOTIVOS_TURNOS D &#xA; WHERE LTRIM(RIGHT(T.de_tramite_turno, LEN(T.de_tramite_turno)-CHARINDEX('- ', T.de_tramite_turno)))=D.de_motivo_turno)&#xA;END&#xA;&#xA;UPDATE D_TRAMITES_TURNOS&#xA;SET id_origen_turno = O.id_origen_turno&#xA;FROM D_TRAMITES_TURNOS S INNER JOIN D_ORIGENES_TURNOS O ON (&#xA;  CASE &#xA;    WHEN LEFT(de_tramite_turno, CHARINDEX(' -', de_tramite_turno)) = '' AND de_tramite_turno = 'Asesoramiento comercial'  THEN 'Asesoramiento comercial' &#xA;       WHEN LEFT(de_tramite_turno, CHARINDEX(' -', de_tramite_turno)) = 'Asociado' OR de_tramite_turno = 'Asociado' THEN 'Asociado' &#xA;    WHEN LEFT(de_tramite_turno, CHARINDEX(' -', de_tramite_turno)) IN ('Prestador', 'Prestadores') OR de_tramite_turno = 'Prestador' THEN 'Prestador' &#xA;  ELSE 'F/D'&#xA;  END=O.de_origen_turno)&#xA;WHERE S.id_origen_turno IS NULL&#xA;&#xA;&#xA;/* Parche 22 05 2019     */ &#xA;&#xA;UPDATE D_TRAMITES_TURNOS&#xA;SET id_origen_turno = O.id_origen_turno&#xA;FROM D_TRAMITES_TURNOS S INNER JOIN D_ORIGENES_TURNOS O ON (&#xA;  CASE &#xA;   WHEN  de_tramite_turno like '%Asesoramiento comercial%'  THEN 'Asesoramiento comercial' &#xA;       WHEN  de_tramite_turno like '%Asociado%'  THEN 'Asociado' &#xA;    WHEN  de_tramite_turno like '%Prestador%' THEN 'Prestador' &#xA;  &#xA;  ELSE 'F/D'&#xA;  END=O.de_origen_turno)&#xA;WHERE S.id_origen_turno = 0&#xA;&#xA;&#xA;UPDATE D_TRAMITES_TURNOS&#xA;SET de_tramite_turno = (SELECT DISTINCT LTRIM(RIGHT(de_tramite_turno, LEN(de_tramite_turno)-CHARINDEX('- ', de_tramite_turno))) &#xA;FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[qqueues_sancorsalud])&#xA;&#xA;UPDATE D_TRAMITES_TURNOS&#xA;SET id_motivo_turno = T.id_motivo_turno&#xA;FROM D_TRAMITES_TURNOS S INNER JOIN D_MOTIVOS_TURNOS T ON (S.de_tramite_turno=T.de_motivo_turno)&#xA;WHERE S.id_motivo_turno IS NULL&#xA;&#xA;&#xA;INSERT INTO D_USUARIOS_TURNOS&#xA;SELECT id, first_name+' '+last_name, email FROM&#xA;[DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[uusers_sancorsalud] WHERE id NOT IN (&#xA;SELECT id_usuario_turno FROM D_USUARIOS_TURNOS)&#xA;&#xA;&#xA;&#xA;--- Se modifican los usuarios y los puestos, a pedido de Muriel esto quedó de manera diaria.&#xA;---- 08/02/2018 no se actualizan más estos campos en D_USUARIOS_TURNOS, ahora se envia un mail.&#xA;--UPDATE D_USUARIOS_TURNOS&#xA;--SET de_usuario_turno = first_name+' '+last_name&#xA;--FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[uusers_sancorsalud] U INNER JOIN D_USUARIOS_TURNOS T ON (U.id=T.id_usuario_turno)&#xA;--where de_usuario_turno COLLATE SQL_Latin1_General_CP1_CI_AS&lt;&gt;first_name+' '+last_name&#xA;&#xA;&#xA;--UPDATE D_USUARIOS_TURNOS&#xA;--SET email_usuario_turno = email&#xA;--FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[uusers_sancorsalud] U INNER JOIN D_USUARIOS_TURNOS T ON (U.id=T.id_usuario_turno)&#xA;--where email_usuario_turno COLLATE SQL_Latin1_General_CP1_CI_AS&lt;&gt;email&#xA;&#xA;&#xA;--- Borra todos los registros de la tabla Temporal de envio mail&#xA;    Delete from Consultas_DW.dbo.TMP_ENVIO_MAIL_USUARIO_TOTEM_SOLO_MAIL&#xA;&#xA;    ---- Insert nuevos campo a la temporal&#xA;&#xA;    Insert Consultas_DW.dbo.TMP_ENVIO_MAIL_USUARIO_TOTEM_SOLO_MAIL&#xA;    select RTRIM(ID) as ID,&#xA;        RTRIM(SUBSTRING(email, 1 , LEN(email))) as Email,  t.email_usuario_turno as Email_Anterior&#xA;    &#xA;      FROM [DEBQCLIENTSDB.DEBMEDIA.COM].[debq].[dbo].[uusers_sancorsalud] U INNER JOIN D_USUARIOS_TURNOS T ON (U.id=T.id_usuario_turno)&#xA;      where (email_usuario_turno COLLATE SQL_Latin1_General_CP1_CI_AS&lt;&gt;email)&#xA;     &#xA;       &#xA;      &#xA;----Envío por mail los nuevos Usuario/Puesto  para ver si están bien parametrizados.&#xA;&#xA;IF (select COUNT(*) from Consultas_DW.dbo.TMP_ENVIO_MAIL_USUARIO_TOTEM_SOLO_MAIL) &gt; 0&#xA;&#xA;begin&#xA;&#xA;EXEC msdb.dbo.sp_send_dbmail&#xA;    @profile_name = 'Soporte Microstrategy',&#xA;    @recipients = 'nicolas.borio@sancorsalud.com.ar; juanfrancisco.trinchieri@sancorsalud.com.ar; belen.lemos@sancorsalud.com.ar',                 &#xA;    @subject = 'Modificación Usuarios - Sistema Turnos',&#xA;    @body = 'Se detectaron cambios en los siguientes Usuarios: &#xA;    &#xA;    ',&#xA;    @query = 'select ID, Email as  [Email/Nuevo], Email_Anterior as [Email/Anterior]  from Consultas_DW.dbo.TMP_ENVIO_MAIL_USUARIO_TOTEM_SOLO_MAIL&#xA;      &#xA;      ',&#xA;    @query_result_separator = '|',&#xA;    @execute_query_database = 'DW_SALUD';&#xA;  end   &#xA;&#xA;&#xA;-- Actualización de la compañia de atencion personal en la tabla D_POSICION.&#xA;&#xA;UPDATE D_POSICION&#xA;SET id_compania_atencion_personal = C.id_compania_atencion_personal&#xA;FROM D_POSICION_BRANCH_TURNOS D &#xA;INNER JOIN D_COMPANIAS_ATENCION_PERSONAL C ON (D.id_compania_turnos=C.id_compania_turnos AND D.id_compania_encuestas=C.id_compania_encuestas)&#xA;INNER JOIN D_POSICION P ON (P.id_posicion=D.id_posicion)&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Crea variable FechaMax"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{82F01016-5A41-4870-98F8-B8A4F914AFDE}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Crea variable FechaMax"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="/*Crea variable fecha_max */&#xA;SELECT MAX(fecha_inicio_turno) fecha_max FROM H_TOTEM_TURNOS"
          SQLTask:ResultType="ResultSetType_SingleRow" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ResultBinding
            SQLTask:ResultName="fecha_max"
            SQLTask:DtsVariableName="User::fecha_max" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Elimina Aux"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Tarea Ejecutar SQL"
      DTS:DTSID="{E95BD477-29BC-4D0C-ACE1-A5EDA2FBE294}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Elimina Aux"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="TRUNCATE TABLE CONSULTAS_DW.DBO.AUX_MOVIMIENTOS_TURNOS" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Inserta en H_TOTEM_TURNOS"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{1417A64B-9466-4FBE-8468-C8A36AF0C4B7}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Inserta en H_TOTEM_TURNOS"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="--Inserta la información limpia obtenida en la AUX.&#xA;INSERT INTO H_TOTEM_TURNOS&#xA;&#x9;&#x9;(id_periodo, &#xA;&#x9;&#x9; id_turno, &#xA;&#x9;&#x9; id_usuario_turno, &#xA;&#x9;&#x9; id_puesto_turno, &#xA;&#x9;&#x9; id_estado_turno, &#xA;&#x9;&#x9; id_posicion, &#xA;&#x9;&#x9; nro_documento,&#xA;&#x9;&#x9; id_empresa_legajo_gerente, &#xA;&#x9;&#x9; id_legajo_gerente, &#xA;&#x9;&#x9; id_empresa_legajo_jefe_regional, &#xA;&#x9;&#x9; id_legajo_jefe_regional,&#xA;&#x9;&#x9; id_empresa_legajo_supervisor_zonal, &#xA;&#x9;&#x9; id_legajo_supervisor_zonal, &#xA;&#x9;&#x9; id_empresa_legajo_responsable_car, &#xA;&#x9;&#x9; id_legajo_responsable_car,&#xA;&#x9;&#x9; id_empresa_legajo_oficial_atencion, &#xA;&#x9;&#x9; id_legajo_oficial_atencion, &#xA;&#x9;&#x9; fecha_inicio_turno, &#xA;&#x9;&#x9; fecha_fin_turno, &#xA;&#x9;&#x9; tiempo_espera_cola,&#xA;&#x9;&#x9; tiempo_atencion, &#xA;&#x9;&#x9; tiempo_espera_cola_minutos,&#xA;&#x9;&#x9; tiempo_atencion_minutos, &#xA;&#x9;&#x9; cant_turnos, &#xA;&#x9;&#x9; cant_turnos_abandono,&#xA;&#x9; &#x9; cant_dias_habiles, &#xA;&#x9;&#x9; id_marca_totem,&#xA;&#x9;&#x9; id_marca_tramite_asociado,&#xA;&#x9;&#x9; id_persona,&#xA;&#x9;&#x9; id_producto,&#xA;&#x9;&#x9; id_subproducto,&#xA;&#x9;&#x9; id_plan_producto,&#xA;&#x9;&#x9; id_compania)&#xA;SELECT   id_periodo,&#xA;         id_turno,&#xA;         id_usuario_turno,&#xA;         id_puesto_turno,&#xA;         id_estado_turno,&#xA;         id_posicion,&#xA;         nro_documento,&#xA;         id_empresa_legajo_gerente,&#xA;&#x9;&#x9; id_legajo_gerente,&#xA;&#x9;&#x9; id_empresa_legajo_jefe_regional,&#xA;&#x9;&#x9; id_legajo_jefe_regional,&#xA;&#x9;&#x9; id_empresa_legajo_supervisor_zonal,&#xA;&#x9;&#x9; id_legajo_supervisor_zonal,&#xA;&#x9;&#x9; id_empresa_legajo_responsable_car,&#xA;&#x9;&#x9; id_legajo_responsable_car,&#xA;&#x9;&#x9; id_empresa_legajo_oficial_atencion,&#xA;&#x9;&#x9; id_legajo_oficial_atencion,&#xA;         fecha_inicio_turno,&#xA;         fecha_fin_turno,&#xA;         tiempo_espera_cola,&#xA;         tiempo_atencion,&#xA;         tiempo_espera_cola_minutos,&#xA;         tiempo_atencion_minutos,&#xA;         cant_turnos,&#xA;         cant_turnos_abandono,&#xA;         0 as cant_dias_habiles,&#xA;         0 as id_marca_totem,&#xA;         id_marca_tramite_asociado,&#xA;&#x9;&#x9; id_persona,&#xA;&#x9;&#x9; id_producto,&#xA;&#x9;&#x9; id_subproducto,&#xA;&#x9;&#x9; id_plan_producto,&#xA;&#x9;&#x9; id_compania&#xA;FROM AUX_H_TOTEM_TURNOS&#xA;WHERE id_turno not in (select distinct id_turno from H_TOTEM_TURNOS)&#xA;&#xA;SELECT * FROM H_TOTEM_TURNOS&#xA;&#xA;UPDATE H_TOTEM_TURNOS&#xA;SET objetivo_tiempo_espera_turnos = &#xA;CASE&#xA;&#x9;WHEN id_periodo &lt;= 201907 AND objetivo_tiempo_espera_turnos IS NULL THEN 10.00&#xA;&#x9;WHEN id_periodo &gt;= 201908 AND objetivo_tiempo_espera_turnos IS NULL THEN 12.00&#xA;&#x9;ELSE 0&#xA;END&#xA;&#xA;UPDATE H_TOTEM_TURNOS&#xA;SET objetivo_tiempo_atencion_turnos = &#xA;CASE&#xA;&#x9;WHEN id_periodo &lt;= 201907 AND objetivo_tiempo_atencion_turnos IS NULL THEN 12.00&#xA;&#x9;WHEN id_periodo &gt;= 201908 AND objetivo_tiempo_atencion_turnos IS NULL THEN 15.00&#xA;&#x9;ELSE 0&#xA;END" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Inserta en H_TRAMITES_TURNOS"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{54F77CD7-ACB7-450C-8F3C-3B1C4F7DFBA9}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Inserta en H_TRAMITES_TURNOS"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{4081693F-AEA7-4256-9077-CD881119B1DE}"
          SQLTask:SqlStatementSource="DECLARE @FechaMax DATETIME&#xA;SET @FechaMax = ?&#xA;&#xA;DELETE H_TRAMITES_TURNOS WHERE id_periodo = dbo.DevuelvePeriodo(GETDATE())&#xA;&#xA;-- Inserta los datos limpios en el detalle.&#xA;INSERT INTO H_TRAMITES_TURNOS&#xA;SELECT  id_periodo,&#xA;         id_turno,&#xA; id_tramite_turno,&#xA; tiempo_espera_cola_tramite,&#xA; tiempo_atencion_tramite&#xA;FROM AUX_H_TRAMITES_TURNOS&#xA;&#xA;-- Actualiza las cantidad de dias habiles por periodo&#xA;insert into D_CANTIDAD_DIAS_HABILES&#xA;(id_periodo, cant_dias_habiles)&#xA;select id_periodo, count(id_periodo) as cant_dias_habiles &#xA;from D_FECHA f&#xA;where  f.id_periodo not in ( select id_periodo from D_CANTIDAD_DIAS_HABILES) &#xA;and id_dia_habil = 1 and id_periodo &gt; 201702 group by id_periodo &#xA;order by id_periodo desc&#xA;&#xA;update D_CANTIDAD_DIAS_HABILES&#xA;set cant_dias_habiles = dias_habiles&#xA;from D_CANTIDAD_DIAS_HABILES D&#xA;INNER JOIN  (select id_periodo, count(id_periodo) as dias_habiles from D_FECHA f where id_dia_habil = 1 group by id_periodo ) I on D.id_periodo = I.id_periodo&#xA;where D.cant_dias_habiles &lt;&gt; I.dias_habiles and D.id_periodo &gt; 201702 &#xA;&#xA;-- Actualiza los dias habiles por periodo hasta ese dia&#xA;Update H_TOTEM_TURNOS &#xA;SET cant_dias_habiles = C.cant_dias_habiles&#xA;FROM H_TOTEM_TURNOS T&#xA;INNER JOIN D_CANTIDAD_DIAS_HABILES C ON T.id_periodo = C.id_periodo&#xA;WHERE T.id_periodo IN (SELECT MAX(id_periodo) FROM H_TOTEM_TURNOS) &#xA;&#xA;-- Marca cuando el tramite es de asociados.&#xA;UPDATE H_TOTEM_TURNOS&#xA;SET id_marca_tramite_asociado = 1&#xA;FROM H_TOTEM_TURNOS H &#xA;INNER JOIN H_TRAMITES_TURNOS T ON (H.id_turno=T.id_turno)&#xA;INNER JOIN D_TRAMITES_TURNOS D ON (T.id_tramite_turno=D.id_tramite_turno)&#xA;WHERE id_origen_turno = 1 AND fecha_inicio_turno &gt; @FechaMax" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
          <SQLTask:ParameterBinding
            SQLTask:ParameterName="0"
            SQLTask:DtsVariableName="User::fecha_max"
            SQLTask:ParameterDirection="Input"
            SQLTask:DataType="7"
            SQLTask:ParameterSize="-1" />
        </SQLTask:SqlTaskData>
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint]"
      DTS:CreationName=""
      DTS:DTSID="{EAE6BC6A-A0AC-4EB1-BE1B-7CA240F89289}"
      DTS:From="Package\Inserta en H_TOTEM_TURNOS"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint"
      DTS:To="Package\Actualiza marca totem" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 1]"
      DTS:CreationName=""
      DTS:DTSID="{121A7EAF-9849-45C6-A623-7703D5947B7E}"
      DTS:From="Package\Actualiza tablas de dimensión"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 1"
      DTS:To="Package\Elimina Aux" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 2]"
      DTS:CreationName=""
      DTS:DTSID="{32ACDCE1-4C80-4C30-BCC8-735FD3B8CC4E}"
      DTS:From="Package\Actualiza AUX_H_TOTEM_TURNOS"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 2"
      DTS:To="Package\Crea variable FechaMax" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 3]"
      DTS:CreationName=""
      DTS:DTSID="{F144D1F9-9806-415A-876C-CBE4BD273394}"
      DTS:From="Package\Crea variable FechaMax"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 3"
      DTS:To="Package\Inserta en H_TOTEM_TURNOS" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 5]"
      DTS:CreationName=""
      DTS:DTSID="{BF6B56CA-510C-4EF7-AEAE-546532FFB98B}"
      DTS:From="Package\Actualiza AUX_H_TRAMITES_TURNOS"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 5"
      DTS:To="Package\Inserta en H_TRAMITES_TURNOS" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 6]"
      DTS:CreationName=""
      DTS:DTSID="{0530DACA-2E51-4CB5-8084-23A2AD256BB8}"
      DTS:From="Package\Actualiza marca totem"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 6"
      DTS:To="Package\Actualiza AUX_H_TRAMITES_TURNOS" />
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint 7]"
      DTS:CreationName=""
      DTS:DTSID="{BD99D481-9E62-4792-8397-E599F28A0B22}"
      DTS:From="Package\Elimina Aux"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint 7"
      DTS:To="Package\Actualiza AUX_H_TOTEM_TURNOS" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="16" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="260,42"
          Id="Package\Actualiza AUX_H_TOTEM_TURNOS"
          TopLeft="67.7310156068018,146.475741239892" />
        <NodeLayout
          Size="278,42"
          Id="Package\Actualiza AUX_H_TRAMITES_TURNOS"
          TopLeft="58.7310156068018,428.427223719677" />
        <NodeLayout
          Size="188,42"
          Id="Package\Actualiza marca totem"
          TopLeft="103.731015606802,357.939353099731" />
        <NodeLayout
          Size="224,42"
          Id="Package\Actualiza tablas de dimensión"
          TopLeft="85.7310156068018,5.5" />
        <NodeLayout
          Size="199,42"
          Id="Package\Crea variable FechaMax"
          TopLeft="98.2310156068018,216.963611859838" />
        <NodeLayout
          Size="137,42"
          Id="Package\Elimina Aux"
          TopLeft="129.231015606802,75.9878706199461" />
        <NodeLayout
          Size="236,42"
          Id="Package\Inserta en H_TOTEM_TURNOS"
          TopLeft="79.7310156068018,287.451482479785" />
        <NodeLayout
          Size="253,42"
          Id="Package\Inserta en H_TRAMITES_TURNOS"
          TopLeft="71.2310156068018,498.915094339623" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint]"
          TopLeft="197.731015606802,329.451482479785">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199461"
              Start="0,0"
              End="0,20.9878706199461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 1]"
          TopLeft="197.731015606802,47.5">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199461"
              Start="0,0"
              End="0,20.9878706199461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 2]"
          TopLeft="197.731015606802,188.475741239892">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199461"
              Start="0,0"
              End="0,20.9878706199461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 3]"
          TopLeft="197.731015606802,258.963611859838">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199461"
              Start="0,0"
              End="0,20.9878706199461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 5]"
          TopLeft="197.731015606802,470.427223719677">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199462"
              Start="0,0"
              End="0,20.9878706199462">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199462" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 6]"
          TopLeft="197.731015606802,399.939353099731">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199461"
              Start="0,0"
              End="0,20.9878706199461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint 7]"
          TopLeft="197.731015606802,117.987870619946">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,28.4878706199461"
              Start="0,0"
              End="0,20.9878706199461">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20.9878706199461" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>