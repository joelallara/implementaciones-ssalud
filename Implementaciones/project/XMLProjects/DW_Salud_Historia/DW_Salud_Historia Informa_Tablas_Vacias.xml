<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="12/5/2018 2:55:09 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\pgonzalez"
  DTS:DTSID="{D7E7BAF1-E75D-434A-8B13-7F52C39EC44F}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="DW_Salud_Historia Informa_Tablas_Vacias"
  DTS:PackageType="5"
  DTS:VersionBuild="4"
  DTS:VersionGUID="{6A3A3E9B-30AB-4069-902E-C493A89857E2}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{B172886B-9032-4827-889F-15ACBF0FC6E2}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{B172886B-9032-4827-889F-15ACBF0FC6E2}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Informa Tablas Vacias"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{BBABDE65-B6E7-45F1-A9C3-2480559F6A5B}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Informa Tablas Vacias"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{7152548D-1BD4-45F8-9539-D6DC8509F30B}"
          SQLTask:SqlStatementSource="&#xA;/* Actualiza la tabla de PLANES */&#xA;&#xA;&#x9;&#x9;-- Actualiza todos los casos como ya informados para mantener los casos detectados pero solo informar los nuevos.&#xA;&#xA;&#x9;&#x9;UPDATE Consultas_DW.dbo.NOTIFICACION_Tablas_Vacias_Catalogo set informada = 1 &#xA;&#xA;&#x9;&#x9;-- Actualiza tabla disparadora Consultas_DW.dbo.NOTIFICACION_Planes_Dimensiones.&#xA;&#x9;&#x9;&#x9;INSERT INTO Consultas_DW.dbo.NOTIFICACION_Tablas_Vacias_Catalogo&#xA;&#x9;&#x9;&#x9;(Tabla_Nombre, Cant_Registros, Informada)&#xA;&#x9;&#x9;&#x9;SELECT T.Tabla_Nombre, si.rowcnt as Cant_Registros, 0 as Informada&#xA;&#x9;&#x9;&#x9;FROM sysobjects as SO&#xA;&#x9;&#x9;&#x9;join sysindexes as SI on SO.Id = SI.id&#xA;&#x9;&#x9;&#x9;join DW_SALUD.dbo.D_DOCUMENTACION_TABLAS T on SO.Name = T.Tabla_Nombre&#xA;&#x9;&#x9;&#x9;WHERE SO.Name like ('H_%')and indid = 0 and si.rowcnt = 0&#xA;&#x9;&#x9;&#x9;and t.Tabla_Nombre not in (select Tabla_Nombre from Consultas_DW.dbo.NOTIFICACION_Tablas_Vacias_Catalogo)&#xA;&#xA;&#x9;&#x9;-- Informa&#xA;&#x9;&#x9;IF (select COUNT(Informada) &#xA;&#x9;&#x9;from Consultas_DW.dbo.NOTIFICACION_Tablas_Vacias_Catalogo&#xA;&#x9;&#x9;where Informada = 0) &gt; 0&#xA;&#xA;&#x9;&#x9;&#x9;begin&#xA;&#xA;&#x9;&#x9;EXEC msdb.dbo.sp_send_dbmail&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;@profile_name = 'Soporte MicroStrategy',&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;@recipients =  'pedro.gonzalez@sancorsalud.com.ar',&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;@subject = 'Tablas Vacias en Catalogo.',&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;@body = 'Chequear:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;* Existen Atributos o Metricas dependientes de esta tabla? Tratar de sanear el modelo.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;',&#xA;&#xA;&#x9;&#x9;&#x9;@query = 'select distinct Tabla_Nombre from Consultas_DW.dbo.NOTIFICACION_Tablas_Vacias_Catalogo where informada = 0',&#xA;&#x9;&#x9;&#x9;@execute_query_database = 'DW_SALUD';&#xA;&#xA;&#x9;&#x9;end&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="188,42"
          Id="Package\Informa Tablas Vacias"
          TopLeft="5.5,5.5" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>