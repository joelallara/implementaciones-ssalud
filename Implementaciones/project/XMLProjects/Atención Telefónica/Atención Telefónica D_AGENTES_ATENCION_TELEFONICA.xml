<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="10/19/2017 11:39:30 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\jtrinchier"
  DTS:DTSID="{CD04BB0B-6D0F-4342-BB97-D9AB48A8899F}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Atención Telefónica D_AGENTES_ATENCION_TELEFONICA"
  DTS:PackageType="5"
  DTS:VersionBuild="24"
  DTS:VersionGUID="{72D90397-88DB-46A6-BB48-324BD87FEA90}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{B82631C0-8F44-4189-A51D-9F2CC03382E8}"
      DTS:ObjectName="SSIS log provider for SQL Server1">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{B82631C0-8F44-4189-A51D-9F2CC03382E8}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\ACTUALIZA D_AGENTES_ATENCION_TELEFONICA"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{0F10129B-1C37-4808-ADB1-BC79BB04DB29}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="ACTUALIZA D_AGENTES_ATENCION_TELEFONICA"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{58454B55-6F22-4144-A3E3-01AE826FF475}"
          SQLTask:SqlStatementSource="IF (SELECT TOP 1 Legajo FROM [IVR-417].ContactCenter.dbo.Agentes S&#xA;where S.Legajo not in &#xA;(select  D.id_agente_atencion_telefonica&#xA;FROM D_AGENTES_ATENCION_TELEFONICA D)) IS NOT NULL&#xA;begin &#xA;&#x9;EXEC msdb.dbo.sp_send_dbmail&#xA;&#x9;&#x9;&#x9;&#x9;@profile_name = 'Soporte Microstrategy',&#xA;&#x9;&#x9;&#x9;&#x9;@recipients = 'nicolas.borio@sancorsalud.com.ar; juanfrancisco.trinchieri@sancorsalud.com.ar',&#xA;&#x9;&#x9;&#x9;&#x9;@subject = 'Nuevo Agente Telefónico',&#xA;&#x9;&#x9;&#x9;&#x9;@body = 'Se agrega un nuevo Agente. Parametrizar usuario de sistema de contacto y Web Centrix. Usar las tablas D_USUARIOS_CARGA_CONTACTOS , AMS07X.IntranetX.dbo.ObjetivosCallCenterWebCentrix y para el campo token se le debe actualizar con la siguiente funcion:  /* select dbo.fnCustomPass(10,(''CN''))*/ ',&#xA;&#x9;&#x9;&#x9;&#x9;@query = 'select Legajo, Nombre_del_Agente, 0 as id_usuario_carga_contacto&#xA;&#x9;&#x9;&#x9;&#x9;from [IVR-417].ContactCenter.dbo.Agentes S&#xA;&#x9;&#x9;&#x9;&#x9;where S.Legajo not in &#xA;&#x9;&#x9;&#x9;&#x9;(select  D.id_agente_atencion_telefonica&#xA;&#x9;&#x9;&#x9;&#x9;FROM D_AGENTES_ATENCION_TELEFONICA D)',&#xA;&#x9;&#x9;&#x9;&#x9;@query_result_separator = '|',&#xA;&#x9;&#x9;&#x9;&#x9;@execute_query_database = 'DW_SALUD';&#xA;end&#xA;&#xA;---- Comprueba si existe en el servidor IVR-417 nueva información y la inserta en la tabla&#xA;INSERT INTO D_AGENTES_ATENCION_TELEFONICA &#xA;(id_agente_atencion_telefonica, &#xA;de_agente_atencion_telefonica,&#xA;id_usuario_carga_contacto)&#xA;select Legajo, Nombre_del_Agente, 0 as id_usuario_carga_contacto&#xA;from [IVR-417].ContactCenter.dbo.Agentes S&#xA;where S.Legajo not in &#xA;(select  D.id_agente_atencion_telefonica&#xA;FROM D_AGENTES_ATENCION_TELEFONICA D)&#xA;&#xA;&#xA;UPDATE D_AGENTES_ATENCION_TELEFONICA&#xA;SET id_usuario_carga_contacto = IdUsuarioContacto&#xA;FROM D_AGENTES_ATENCION_TELEFONICA D INNER JOIN [INTRANET].[IntranetX].[dbo].[ObjetivosCallCenterAgentes] A &#xA;ON (A.idAgente=D.id_agente_atencion_telefonica)&#xA;where IdUsuarioContacto  not in (select id_usuario_carga_contacto from D_AGENTES_ATENCION_TELEFONICA)&#xA;&#xA;&#xA;&#xA;--ACTUALIZA USUARIO WEBCENTRIX EN TABLA DE AGENTES&#xA;SELECT Usuario_WC, MAX(fecha_WC) fecha_WC INTO #USERS FROM [INTRANET].[IntranetX].[dbo].[ObjetivosCallCenterWebCentrix]&#xA;GROUP BY Usuario_WC&#xA;&#xA;&#xA;UPDATE D_AGENTES_ATENCION_TELEFONICA&#xA;SET usuario_web_centrix = Usuario_WC&#xA;FROM D_USUARIOS_CARGA_CONTACTOS C &#xA;INNER JOIN #USERS U ON (C.de_usuario_carga_contacto COLLATE Latin1_General_CI_AI=U.Usuario_WC)&#xA;INNER JOIN D_AGENTES_ATENCION_TELEFONICA A ON (A.id_usuario_carga_contacto=C.id_usuario_carga_contacto)&#xA;where Usuario_WC not in (select usuario_web_centrix COLLATE Latin1_General_CI_AI from D_AGENTES_ATENCION_TELEFONICA)&#xA;&#xA;&#xA;-- Actualizo los grupos de agentes cuando encuentra uno nuevo&#xA; insert into D_GRUPOS_AGENTES_TELEFONICO&#xA; (id_grupo_agente_telefonico, de_grupo_agente_telefonico)&#xA; select grupoID, Nombre&#xA; from  [IVR-417].ContactCenter.dbo.grupodeAgentes&#xA; where grupoid not in (select id_grupo_agente_telefonico from D_GRUPOS_AGENTES_TELEFONICO)&#xA;&#xA;--Modifico el nombre del grupo si es que cambia &#xA; update D_GRUPOS_AGENTES_TELEFONICO&#xA; set de_grupo_agente_telefonico = g.Nombre&#xA; from D_GRUPOS_AGENTES_TELEFONICO d&#xA; inner join [IVR-417].ContactCenter.dbo.grupodeAgentes g on d.id_grupo_agente_telefonico = g.grupoid&#xA; where  de_grupo_agente_telefonico &lt;&gt; g.nombre collate SQL_Latin1_General_CP1_CI_AS &#xA;&#xA;-- Actualiza Grupo de agentes&#xA; update D_AGENTES_ATENCION_TELEFONICA &#xA; set id_grupo_agente_telefonico = GrupoDeAgentes&#xA;  from D_AGENTES_ATENCION_TELEFONICA D&#xA; inner join  [IVR-417].ContactCenter.dbo.Agentes S on D.id_agente_atencion_telefonica = s.legajo&#xA; " xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="347,42"
          Id="Package\ACTUALIZA D_AGENTES_ATENCION_TELEFONICA"
          TopLeft="27.5,21.5" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>