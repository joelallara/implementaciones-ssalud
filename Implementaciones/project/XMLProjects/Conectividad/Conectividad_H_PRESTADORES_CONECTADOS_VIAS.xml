<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="11/10/2017 1:59:32 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\pgonzalez"
  DTS:DTSID="{2361CACC-459E-4F8D-BBCD-68AA7B190FFF}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Conectividad_H_PRESTADORES_CONECTADOS_VIAS"
  DTS:PackageType="5"
  DTS:VersionBuild="19"
  DTS:VersionGUID="{C8837812-FD88-43F9-BF54-2F44ECC1AE65}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{BECEAEE0-015E-49D8-B09B-1AA754AFE219}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{BECEAEE0-015E-49D8-B09B-1AA754AFE219}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Actualiza H_PRESTADORES_CONECTADOS_VIAS"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:DTSID="{6e8713d0-9e18-436b-8f1a-6817938ffbc7}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza H_PRESTADORES_CONECTADOS_VIAS"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{8BD4D703-8049-4F8E-B36A-AAAD9C1434D4}"
          SQLTask:SqlStatementSource="&#xA;IF DATEPART(day,GETDATE()) = 1&#xA;&#xA;&#x9;begin &#xA;&#x9;&#xA;&#x9;&#x9;DECLARE @Periodo Int SET @Periodo = dbo.DevuelvePeriodo(GETDATE())&#xA;&#x9;&#x9;DECLARE @Periodo_Baja Int SET @Periodo_Baja = dbo.PeriodoAnterior(CAST(CAST(@Periodo as CHAR(6))+'01' as datetime))&#xA;&#xA;/* Actualiza H_PRESTADORES_CONECTADOS_VIAS. */&#xA;&#xA;&#x9;DELETE FROM H_PRESTADORES_CONECTADOS_VIAS WHERE id_periodo = @Periodo&#xA;&#xA;&#x9;INSERT INTO H_PRESTADORES_CONECTADOS_VIAS&#xA;&#x9;(id_periodo, id_acreedor, id_tipo_prestador, id_canal_transaccion, cant_prestadores_conectados_por_via, id_periodo_alta_via, id_periodo_baja_via)&#xA;&#x9;SELECT distinct @Periodo as id_periodo, WE03CP as id_acreedor, 'P' as id_tipo_prestador, (CASE when WE03OR = 6 then 2 else WE03OR end ) as id_canal_transaccion, 1 as cant_prestadores_conectados_por_via, SUBSTRING(CAST(WE03FE as CHAR(8)),1,6) as id_periodo_alta_via, 0 as id_periodo_baja_via&#xA;&#x9;FROM HOST03.HOST03.SMPLIBD.CO03FCLI C&#xA;&#x9;WHERE WE03ES = 0 /* Estado Activo en base de Prestadores de Conectividad. */&#xA;&#x9;and exists (select id_acreedor from D_ACREEDOR A where A.id_acreedor = C.WE03CP and A.id_estado_acreedor in (0,2)) -- Estado Activo e Inactivo (hacen prestaciones pero no facturan) en base de Prestadores General. Mediante este filtro tenemos coherencia en los datos entre Prestadores de Conectividad y los Datas.&#xA;&#xA;&#x9;-- Actualiza el periodo de baja de cada canal. &#xA;&#x9;&#x9;SELECT&#x9;WE03CP as id_acreedor,&#xA;&#x9;&#x9;&#x9;&#x9;(CASE&#x9;when (WE03OR = 1) then 0 -- Austral OMI F/D.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;when (WE03OR = 2) then 1 -- Conexia.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;when (WE03OR = 3) then 3 -- AMR.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;when (WE03OR = 4) then 4 -- Web Service.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;when (WE03OR = 5) then 5 -- SanCor Web.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;when (WE03OR = 6) then 2 -- Traditum.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;else 0 end) as id_canal_transaccion, -- F/D.&#xA;&#x9;&#x9;&#x9;MAX(VA3FEC) as fecha_baja,&#xA;&#x9;&#x9;&#x9;MAX(VA3HOR) as Hora&#xA;&#x9;&#x9;Into #Bajas_Convenios&#xA;&#x9;&#x9;FROM HOST03.HOST03.SMPLIBD.VO03FCLI -- Tabla de Auditoria de Acreedores Conectividad.&#xA;&#x9;&#x9;WHERE VA3AUD = 'M' and WE03ES = 1 &#xA;&#x9;&#x9;and dbo.DevuelvePeriodo(CAST(CAST(VA3FEC as CHAR(8)) as datetime)) = @Periodo_Baja -- Detecta todas las bajas que se hicieron el mes pasado.&#xA;&#x9;&#x9;GROUP BY WE03CP, WE03OR&#xA;&#x9;&#x9;ORDER BY WE03CP, WE03OR&#xA;&#xA;&#xA;&#x9;&#x9;UPDATE H_PRESTADORES_CONECTADOS_VIAS&#xA;&#x9;&#x9;&#x9;SET id_periodo_baja_via = dbo.DevuelvePeriodo(CAST(CAST(fecha_baja as CHAR(8)) as datetime))&#xA;&#x9;&#x9;FROM H_PRESTADORES_CONECTADOS_VIAS H&#xA;&#x9;&#x9;join #Bajas_Convenios C on H.id_acreedor = C.id_acreedor and H.id_canal_transaccion = C.id_canal_transaccion&#xA;&#x9;&#x9;&#xA;&#x9;&#x9;drop table #Bajas_Convenios&#xA;&#xA;&#x9;end&#xA;&#xA;&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Esta sección CDATA contiene la información de diseño del paquete. Esta sección incluye información como, por ejemplo, las coordenadas (x,y), el ancho y el alto.-->
<!--Si edita manualmente esta sección y comete un error, puede eliminarlo. -->
<!--El paquete podrá cargarse normalmente, pero se perderá la información de diseño anterior y el diseñador reorganizará los elementos automáticamente en la superficie de diseño.-->
<Objects
  Version="8">
  <!--Cada uno de los nodos siguientes contiene propiedades que no afectan al comportamiento en tiempo de ejecución.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="293,44"
          Id="Package\Actualiza H_PRESTADORES_CONECTADOS_VIAS"
          TopLeft="5.5,5.5" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>