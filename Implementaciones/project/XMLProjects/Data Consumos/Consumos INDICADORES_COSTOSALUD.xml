<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="1/25/2017 7:59:52 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\nborio"
  DTS:DTSID="{AD236742-DC18-4579-846F-645E22E30A54}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Consumos INDICADORES_COSTOSALUD"
  DTS:PackageType="5"
  DTS:VersionBuild="14"
  DTS:VersionGUID="{B790B040-3140-4890-82DC-60A28D92AD57}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{A91A3A80-3134-4B74-AEAF-A112A453D275}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{A91A3A80-3134-4B74-AEAF-A112A453D275}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Actualiza INDICADORES_COSTOSALUD EN AMS07X"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{6F2FBB66-64CA-46E2-8BA9-70DD933F7119}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza INDICADORES_COSTOSALUD EN AMS07X"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{6601EFDC-B0A3-4B05-9A3F-EFAAD98885BF}"
          SQLTask:SqlStatementSource="DELETE Consultas_DW.dbo.AUX_H_DATOS_PERSONA&#xA;&#xA;select distinct id_periodo, id_persona, afiliado, sum(imp_prest_amb_acep) as total_consumo, 0 as total_recaudacion&#xA;into #H_ORD_AMB_DET&#xA;from H_ORD_AMB_DET A&#xA;where id_periodo in (select top 12 id_periodo from D_PERIODO where vigente_consumo = 1 order by id_periodo desc)&#xA;and ccosto3 = 1&#xA;group by id_periodo, id_persona, afiliado&#xA;&#xA;select distinct id_periodo, id_persona, afiliado, sum(imp_prest_int_acep) as total_consumo, 0 as total_recaudacion&#xA;into #H_ORD_INT_DET&#xA;from H_ORD_INT_DET A&#xA;where id_periodo in (select top 12 id_periodo from D_PERIODO where vigente_consumo = 1 order by id_periodo desc)&#xA;and ccosto3 = 1&#xA;group by id_periodo, id_persona, afiliado&#xA;&#xA;select distinct id_periodo, id_persona, afiliado, 0 as total_consumo, SUM(total_recaudacion) as total_recaudacion&#xA;into #H_RECAUDACION_DETALLE&#xA;from H_RECAUDACION_DETALLE A&#xA;where id_periodo in (select top 12 id_periodo from D_PERIODO where vigente_consumo = 1 order by id_periodo desc)&#xA;and rcosto3 = 1&#xA;group by id_periodo, id_persona, afiliado&#xA;&#xA;INSERT INTO Consultas_DW.dbo.AUX_H_DATOS_PERSONA&#xA;Select&#x9;coalesce(A.afiliado, I.afiliado, R.afiliado) afiliado,&#xA;&#x9;&#x9;SUM(ISNULL(A.total_consumo, 0))+SUM(ISNULL(I.total_consumo, 0)) total_consumo,&#xA;&#x9;&#x9;coalesce(A.id_persona, I.id_persona, R.id_persona) id_persona,&#xA;&#x9;&#x9;SUM(ISNULL(R.total_recaudacion, 0)),&#xA;&#x9;&#x9;COUNT(DISTINCT coalesce(A.id_periodo, I.id_periodo, R.id_periodo)) cant_meses,&#xA;&#x9;&#x9;(SELECT MAX(id_periodo) FROM H_ORD_INT_DET)&#xA;from &#xA;#H_ORD_AMB_DET A &#xA;full outer join #H_ORD_INT_DET I &#xA;&#x9;ON (A.id_periodo=I.id_periodo and A.id_persona=I.id_persona and A.afiliado=I.afiliado)&#xA;full outer join #H_RECAUDACION_DETALLE R &#xA;&#x9;ON (A.id_periodo=R.id_periodo and A.id_persona=R.id_persona and A.afiliado=R.afiliado)&#xA;GROUP BY coalesce(A.id_persona, I.id_persona, R.id_persona),&#xA;&#x9;&#x9;coalesce(A.afiliado, I.afiliado, R.afiliado) &#xA;&#xA;DELETE INTRANET.IntranetX.dbo.INDICADORES_COSTOSALUD&#xA;INSERT INTO INTRANET.IntranetX.dbo.INDICADORES_COSTOSALUD&#xA;SELECT&#x9;0,&#xA;&#x9;&#x9;afiliado,&#xA;&#x9;&#x9;total_consumo,&#xA;&#x9;&#x9;id_persona,&#xA;&#x9;&#x9;total_recaudacion,&#xA;&#x9;&#x9;cant_meses,&#xA;&#x9;&#x9;id_periodo&#xA;FROM Consultas_DW.dbo.AUX_H_DATOS_PERSONA &#xA;&#xA;DROP TABLE #H_ORD_AMB_DET&#xA;DROP TABLE #H_ORD_INT_DET&#xA;DROP TABLE #H_RECAUDACION_DETALLE" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="349,42"
          Id="Package\Actualiza INDICADORES_COSTOSALUD EN AMS07X"
          TopLeft="5.5,5.5" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>