<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="11/1/2019 7:31:11 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="DES6103"
  DTS:CreatorName="AMS\jallara"
  DTS:DTSID="{DDAAD03F-959B-4418-B20C-2ED6D3143A2C}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Consumos H_TRANSACCIONES_PRESTACIONES"
  DTS:PackageType="5"
  DTS:VersionBuild="5"
  DTS:VersionGUID="{49FF5089-7985-44C6-886A-9EEC2CF08C33}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{E143A56B-AE27-416D-941E-CF650CA9B9CD}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{E143A56B-AE27-416D-941E-CF650CA9B9CD}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Actualiza H_TRANSACCIONES_PRESTACIONES"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Tarea Ejecutar SQL"
      DTS:DTSID="{151EBEC1-2574-4592-A17B-463969F2AC5B}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza H_TRANSACCIONES_PRESTACIONES"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{6601EFDC-B0A3-4B05-9A3F-EFAAD98885BF}"
          SQLTask:SqlStatementSource="declare @Periodo int&#xA;set @Periodo = (select max(id_periodo) from aux_periodo_mes_borra)&#xA;&#xA;&#x9;&#x9;UPDATE H_TRANSACCIONES_PRESTACIONES&#xA;&#x9;&#x9;SET cant_prest_cons = sumaPrest, &#xA;&#x9;&#x9;&#x9;imp_prest_cons = sumaPagado &#xA;&#x9;&#x9;FROM H_TRANSACCIONES_PRESTACIONES T&#xA;&#x9;&#x9;INNER JOIN (SELECT id_periodo, id_tipo_orden, nro_orden, id_prestacion,sum(imp_pret_amb_pag) as sumaPagado, sum(cant_prest_amb_pag) AS sumaPrest&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;FROM H_ORD_AMB_DET&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;GROUP BY id_periodo, id_tipo_orden, nro_orden, id_prestacion) AS A&#xA;&#x9;&#x9;ON (T.id_tipo_orden_transaccion=A.id_tipo_orden and T.numero_orden_transaccion=A.nro_orden and T.id_prestacion=A.id_prestacion)&#xA;&#x9;&#x9;WHERE A.id_periodo = @Periodo&#xA;&#xA;/* Inicializa en 0 datos de la cup. */&#xA;&#x9;&#xA;&#x9;UPDATE H_TRANSACCIONES_PRESTACIONES&#xA;&#x9;&#x9;SET cant_prest_cup = 0, &#xA;&#x9;&#x9;&#x9;imp_prest_cup = 0&#xA;&#x9;WHERE id_periodo &gt;= @Periodo AND cant_prest_cons &gt; 0  /*Actualiza la cup en 0 siempre que en consumo haya valor */&#xA;&#xA;/* Actualiza prestaciones e importe pagados en H_TRANSACCIONES_PRESTACIONES*/&#xA;&#x9;UPDATE H_TRANSACCIONES_PRESTACIONES&#xA;&#x9;&#x9;SET cant_prest_pag = ISNULL(cant_prest_cons+cant_prest_cup, 0), &#xA;&#x9;&#x9;&#x9;imp_prest_pag = ISNULL(imp_prest_cup + imp_prest_cons,0)" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Esta sección CDATA contiene la información de diseño del paquete. Esta sección incluye información como, por ejemplo, las coordenadas (x,y), el ancho y el alto.-->
<!--Si edita manualmente esta sección y comete un error, puede eliminarlo. -->
<!--El paquete podrá cargarse normalmente, pero se perderá la información de diseño anterior y el diseñador reorganizará los elementos automáticamente en la superficie de diseño.-->
<Objects
  Version="8">
  <!--Cada uno de los nodos siguientes contiene propiedades que no afectan al comportamiento en tiempo de ejecución.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="328,42"
          Id="Package\Actualiza H_TRANSACCIONES_PRESTACIONES"
          TopLeft="5.5,5.5" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>