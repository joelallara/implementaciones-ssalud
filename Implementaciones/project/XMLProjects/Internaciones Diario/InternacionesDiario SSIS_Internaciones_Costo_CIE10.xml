<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="5/21/2015 8:51:10 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\pgonzalez"
  DTS:DTSID="{07102CB5-5ADF-47D7-B6D5-29C333F04097}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="InternacionesDiario SSIS_Internaciones_Costo_CIE10"
  DTS:PackageType="5"
  DTS:VersionBuild="13"
  DTS:VersionGUID="{6D727A21-3119-4B2F-8069-13AB8696B7FE}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{DC8007E7-9B57-437D-A503-A44A754ED9EE}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{DC8007E7-9B57-437D-A503-A44A754ED9EE}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Calculo Costo CIE10"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{9A92066D-A31F-4790-8CC4-B923DA2B9B11}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Calculo Costo CIE10"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{87B3EF38-D424-4CA0-9B98-F49ED069F118}"
          SQLTask:SqlStatementSource="SET DATEFORMAT 'YMD'&#xA;&#xA;-- Calculo Costo de Internaciones por CIE10&#xA;&#xA;TRUNCATE TABLE consumo_formularios_6&#xA;TRUNCATE TABLE H_COSTO_INTERNACIONES_CIE10&#xA;&#xA;DECLARE @Periodo_Consumo INT &#xA;SET @Periodo_Consumo = (SELECT MAX(id_periodo) from D_PERIODO WHERE vigente_consumo = 1)&#xA;DECLARE @Periodo_Desde INT&#xA;&#xA;select top 12 id_periodo&#xA;into #Periodos&#xA;from D_PERIODO &#xA;where vigente_consumo = 1 &#xA;group by id_periodo &#xA;order by id_periodo desc&#xA;&#xA;set @Periodo_Desde = (select MIN(id_periodo) from #Periodos)&#xA;&#xA;INSERT INTO consumo_formularios_6&#xA;(id_anual, id_posicion_no_facturador, id_tipo_internacion, id_diagnostico, nro_orden, consumo_internacion)&#xA;Select @Periodo_Consumo, id_posicion_prestacion , id_tipo_internacion, id_diagnostico, id_orden_relacionada, sum(imp_prest_int_pag)&#xA;from h_ord_int_Det I&#xA;inner join D_PRODUCTOS a14&#xA;   on  (I.id_producto = a14.id_producto)&#xA;where I.id_periodo between @Periodo_Desde and @Periodo_Consumo -- Ultimos 12 M vigentes consumo&#xA;AND id_reintegro = 'F' &#xA;AND id_origen_prestacion = 'I'&#xA;AND id_tipo_orden_relacionada = 6&#xA;and I.id_marca_valorizacion in ('P')&#xA;and a14.Id_Clase_Producto in ('S ')&#xA;and a14.id_segmento not in (3)&#xA;and not ((I.id_producto = 16 and I.id_plan_producto = 'CC   ')&#xA;   or  (I.id_producto=16 and I.id_plan_producto='CM   ')&#xA;   or  (I.id_producto=16 and I.id_plan_producto='CS1  ')&#xA;   or  (I.id_producto=16 and I.id_plan_producto='CS100')&#xA;   or  (I.id_producto=4 and I.id_plan_producto='M    ')&#xA;   or  (I.id_producto=16 and I.id_plan_producto='M    ')&#xA;   or  (I.id_producto=20 and I.id_plan_producto='M    ')&#xA;   or  (I.id_producto=14 and I.id_plan_producto='Z    ')&#xA;   or  (I.id_producto=20 and I.id_plan_producto='Z    ')&#xA;   or  (I.id_producto=1 and I.id_plan_producto='C    ')&#xA;   or  (I.id_producto=4 and I.id_plan_producto='PMO  ')&#xA;   or  (I.id_producto=35 and I.id_plan_producto='PMO  ')&#xA;   or  (I.id_producto=4 and I.id_plan_producto='Z    '))&#xA;GROUP BY id_posicion_prestacion , id_tipo_internacion, id_diagnostico, id_orden_relacionada&#xA;&#xA;--- Actualizacion en los campos de id_posicion_prestacion, id_tipo_internacion, id_diagnostico&#xA;&#xA;UPDATE consumo_formularios_6&#xA;SET id_posicion_no_facturador = A02.id_posicion_no_facturador,&#xA;id_tipo_internacion = A02.id_tipo_internacion,&#xA;id_diagnostico = A02.id_diagnostico,&#xA;dias_totales_internacion = cant_dias_aut_total&#xA;FROM consumo_formularios_6 A01 &#xA;INNER JOIN H_INTERNACIONES_CARLOS A02 ON (A01.nro_orden = A02.nro_orden)&#xA;&#xA;&#xA;INSERT INTO H_COSTO_INTERNACIONES_CIE10 (id_posicion_no_facturador&#xA;           ,[id_tipo_internacion]&#xA;           ,[id_diagnostico]&#xA;           ,[cantidad_internaciones_costo_cie10]&#xA;           ,[consumo_internaciones_costo_cie10]&#xA;           ,[costo_internaciones_cie10]&#xA;&#x9;&#x9;   ,[cantidad_internaciones_dias_promedio]&#xA;&#x9;&#x9;   ,[cantidad_dias_totales_autorizados]&#xA;&#x9;&#x9;   ,[promedio_dias])&#xA;&#xA;select id_posicion_no_facturador, id_tipo_internacion, id_diagnostico, count(distinct nro_orden) as cantidad_internaciones, sum(consumo_internacion) as consumo, &#xA;(sum(consumo_internacion)/Isnull(count(distinct nro_orden),1))as costo_cie10,&#xA;count(distinct nro_orden) as cantidad_internaciones_dias_promedio,&#xA;sum(dias_totales_internacion) as cantidad_dias_totales_autorizados,&#xA;(sum(dias_totales_internacion)/Isnull(count(distinct nro_orden),1)) as promedio_dias&#xA;from consumo_formularios_6&#xA;group by id_posicion_no_facturador, id_tipo_internacion, id_diagnostico" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--Esta sección CDATA contiene la información de diseño del paquete. Esta sección incluye información como, por ejemplo, las coordenadas (x,y), el ancho y el alto.-->
<!--Si edita manualmente esta sección y comete un error, puede eliminarlo. -->
<!--El paquete podrá cargarse normalmente, pero se perderá la información de diseño anterior y el diseñador reorganizará los elementos automáticamente en la superficie de diseño.-->
<Objects
  Version="8">
  <!--Cada uno de los nodos siguientes contiene propiedades que no afectan al comportamiento en tiempo de ejecución.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="181,42"
          Id="Package\Calculo Costo CIE10"
          TopLeft="5.5,5.5" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>