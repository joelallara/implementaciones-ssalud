<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="8/10/2017 7:58:27 AM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="AMS06X"
  DTS:CreatorName="AMS\jtrinchier"
  DTS:DTSID="{3EC4435A-050B-41BC-8D7E-CC0066B43E16}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="15.0.1301.433"
  DTS:LocaleID="11274"
  DTS:ObjectName="Comercial_H_INFO_RANGO_ETARIO_MERCADO"
  DTS:PackageType="5"
  DTS:VersionBuild="13"
  DTS:VersionGUID="{F1BE4BEC-6050-4F74-9C91-160B2D4A042B}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:LogProviders>
    <DTS:LogProvider
      DTS:ConfigString="DS_MSDB"
      DTS:CreationName="Microsoft.LogProviderSQLServer"
      DTS:Description="Writes log entries for events to a SQL Server database"
      DTS:DTSID="{DADEAC42-ECD8-44F0-8357-EF2594D0619D}"
      DTS:ObjectName="SSIS log provider for SQL Server">
      <DTS:ObjectData>
        <InnerObject />
      </DTS:ObjectData>
    </DTS:LogProvider>
  </DTS:LogProviders>
  <DTS:Variables />
  <DTS:LoggingOptions
    DTS:FilterKind="0"
    DTS:LoggingMode="1">
    <DTS:Property
      DTS:DataType="8"
      DTS:Name="EventFilter">1,7,OnError</DTS:Property>
    <DTS:Property
      DTS:EventName="OnError"
      DTS:Name="ColumnFilter">
      <DTS:Property
        DTS:Name="Computer">-1</DTS:Property>
      <DTS:Property
        DTS:Name="Operator">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceName">-1</DTS:Property>
      <DTS:Property
        DTS:Name="SourceID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="ExecutionID">-1</DTS:Property>
      <DTS:Property
        DTS:Name="MessageText">-1</DTS:Property>
      <DTS:Property
        DTS:Name="DataBytes">-1</DTS:Property>
    </DTS:Property>
    <DTS:SelectedLogProviders>
      <DTS:SelectedLogProvider
        DTS:InstanceID="{DADEAC42-ECD8-44F0-8357-EF2594D0619D}" />
    </DTS:SelectedLogProviders>
  </DTS:LoggingOptions>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Actualiza id_categoria_beneficiario en H_COMER_STOCK_AFILIA"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{10E2CA36-FFA4-460D-A12B-594D01BA99DE}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza id_categoria_beneficiario en H_COMER_STOCK_AFILIA"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{C58967E1-D6E6-45BE-BAEB-DD39AA465CE7}"
          SQLTask:SqlStatementSource="&#x9;Declare @Periodo int set @Periodo = (select MAX(id_periodo) from AUX_PERIODO_MES_BORRA)&#xA;&#xA;/* Categoria de Beneficiario en H_COMER_STOCK_AFILIA - 12 09 2017 */&#xA;&#xA;&#x9;-- MOTOTRIBUTISTAS.&#xA;&#x9;UPDATE H_COMER_STOCK_AFILIA&#xA;&#x9;&#x9;set id_categoria_beneficiario = 1&#xA;&#x9;FROM D_PERSONAS D &#xA;&#x9;JOIN H_COMER_STOCK_AFILIA H  ON  D.id_persona = H.id_persona&#xA;&#x9;WHERE id_periodo = @Periodo and D.id_condicion_iva = 6&#xA;&#xA;&#x9;-- AUTONOMOS.&#xA;&#x9;UPDATE H_COMER_STOCK_AFILIA&#xA;&#x9;&#x9;set id_categoria_beneficiario = 2&#xA;&#x9;FROM H_COMER_STOCK_AFILIA H join D_PLANES P ON H.id_plan_producto = P.id_plan_producto and H.id_producto = P.id_producto&#xA;&#x9;JOIN D_SUBRUBRO_LEY S on P.id_SubRubro_ley = S.Id_SubRubro_Ley&#xA;&#x9;WHERE S.Id_SubRubro_Ley in (1,5) and H.id_periodo = @Periodo and id_categoria_beneficiario is null&#xA;&#xA;&#x9;-- RELACION DE DEPENDENCIA.&#xA;&#x9;UPDATE H_COMER_STOCK_AFILIA&#xA;&#x9;&#x9;set id_categoria_beneficiario = 3 &#xA;&#x9;WHERE id_periodo = @Periodo and id_categoria_beneficiario is null AND id_producto &lt;&gt; 18&#xA;&#xA;&#x9;-- AMPS no hay que marcarlo&#xA;&#x9;UPDATE H_COMER_STOCK_AFILIA &#xA;&#x9;&#x9;set id_categoria_beneficiario = 0&#xA;&#x9;WHERE id_periodo = @Periodo and id_producto = 18&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
    <DTS:Executable
      DTS:refId="Package\Actualiza id_rango_etario_mercado en H_COMER_STOCK_AFILIA"
      DTS:CreationName="Microsoft.ExecuteSQLTask"
      DTS:Description="Execute SQL Task"
      DTS:DTSID="{717EE97E-4E10-4436-BC4C-CC26946FA45A}"
      DTS:ExecutableType="Microsoft.ExecuteSQLTask"
      DTS:LocaleID="-1"
      DTS:ObjectName="Actualiza id_rango_etario_mercado en H_COMER_STOCK_AFILIA"
      DTS:TaskContact="Execute SQL Task; Microsoft Corporation; Microsoft SQL Server 2008 R2; © 2007 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
      DTS:ThreadHint="0">
      <DTS:Variables />
      <DTS:LoggingOptions
        DTS:FilterKind="0" />
      <DTS:ObjectData>
        <SQLTask:SqlTaskData
          SQLTask:Connection="{C58967E1-D6E6-45BE-BAEB-DD39AA465CE7}"
          SQLTask:SqlStatementSource="&#xA;&#x9;Declare @Periodo int set @Periodo = (select MAX(id_periodo) from AUX_PERIODO_MES_BORRA)&#xA;&#xA;/* Actualiza el Rango Etario del Mercado */&#xA;&#xA;&#x9;-- Actualiza las personas de entre 18 y 25 años, al titular.&#xA;&#x9;&#x9;SELECT h.afiliado&#xA;&#x9;&#x9;INTO #temp_rango_1&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo and 18 &lt;= h.edad_periodo and 25 &gt; = h.edad_periodo and h.cant_comer_grupo_activo = 1&#xA;&#xA;&#x9;&#x9;CREATE NONCLUSTERED INDEX [IX_afiliado]&#xA;&#x9;&#x9;ON [dbo].[#temp_rango_1] ([afiliado])&#xA;&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado  = 1&#xA;&#x9;&#x9;FROM  H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;JOIN #temp_rango_1 t on t.afiliado = h.afiliado&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo &#xA;&#xA;&#x9;&#x9;drop table #temp_rango_1&#xA;&#xA;&#x9;-- Actualiza las personas de entre 26 y 30 años, al titular.&#xA;&#x9;&#x9;SELECT h.afiliado&#xA;&#x9;&#x9;INTO #temp_rango_2&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo and 26 &lt;= h.edad_periodo and 30 &gt; = h.edad_periodo and h.cant_comer_grupo_activo = 1&#xA;&#xA;&#x9;&#x9;CREATE NONCLUSTERED INDEX [IX_afiliado]&#xA;&#x9;&#x9;ON [dbo].[#temp_rango_2] ([afiliado])&#xA;&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado  = 2&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H &#xA;&#x9;&#x9;JOIN #temp_rango_2 t on t.afiliado = h.afiliado&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo &#xA;&#xA;&#x9;&#x9;drop table #temp_rango_2&#xA;&#xA;&#xA;&#x9;-- Actualiza las personas de entre 31 y 39 años, al titular.&#xA;&#x9;&#x9;SELECT h.afiliado&#xA;&#x9;&#x9;INTO #temp_rango_3&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo and 31 &lt;= h.edad_periodo and 39 &gt; = h.edad_periodo and h.cant_comer_grupo_activo = 1&#xA;&#xA;&#x9;&#x9;CREATE NONCLUSTERED INDEX [IX_afiliado]&#xA;&#x9;&#x9;ON [dbo].[#temp_rango_3] ([afiliado])&#xA;&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado  = 3&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H &#xA;&#x9;&#x9;JOIN #temp_rango_3 t on t.afiliado = h.afiliado&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo &#xA;&#xA;&#x9;&#x9;drop table #temp_rango_3&#xA;&#xA;&#x9;-- Actualiza las personas de entre 40 y 49 años, al titular.&#xA;&#x9;&#x9;SELECT h.afiliado&#xA;&#x9;&#x9;INTO #temp_rango_4&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo and 40 &lt;= h.edad_periodo and 49 &gt; = h.edad_periodo and h.cant_comer_grupo_activo = 1&#xA;&#xA;&#x9;&#x9;CREATE NONCLUSTERED INDEX [IX_afiliado]&#xA;&#x9;&#x9;ON [dbo].[#temp_rango_4] ([afiliado])&#xA;&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado  = 4&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H &#xA;&#x9;&#x9;JOIN #temp_rango_4 t on t.afiliado = h.afiliado&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo &#xA;&#xA;&#x9;&#x9;drop table #temp_rango_4&#xA;&#xA;&#xA;&#x9;-- Actualiza las personas de entre 50 y 59 años, al titular.&#xA;&#x9;&#x9;SELECT h.afiliado&#xA;&#x9;&#x9;INTO #temp_rango_5&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo and 50 &lt;= h.edad_periodo and 59 &gt; = h.edad_periodo and h.cant_comer_grupo_activo = 1&#xA;&#xA;&#x9;&#x9;CREATE NONCLUSTERED INDEX [IX_afiliado]&#xA;&#x9;&#x9;ON [dbo].[#temp_rango_5] ([afiliado])&#xA;&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado  = 5&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H &#xA;&#x9;&#x9;JOIN #temp_rango_5 t on t.afiliado = h.afiliado&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo &#xA;&#xA;&#x9;&#x9;drop table #temp_rango_5&#xA;&#xA;&#xA;&#x9;-- Actualiza las personas de mas de 60, al titular.&#xA;&#x9;&#x9;SELECT h.afiliado&#xA;&#x9;&#x9;INTO #temp_rango_6&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo and 60 &lt; =  h.edad_periodo and h.cant_comer_grupo_activo = 1&#xA;&#xA;&#x9;&#x9;CREATE NONCLUSTERED INDEX [IX_afiliado]&#xA;&#x9;&#x9;ON [dbo].[#temp_rango_6] ([afiliado])&#xA;&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado  = 6&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H &#xA;&#x9;&#x9;JOIN #temp_rango_6 t on t.afiliado = h.afiliado&#xA;&#x9;&#x9;WHERE h.id_periodo = @Periodo &#xA;&#xA;&#x9;&#x9;drop table #temp_rango_6&#xA;&#xA;&#xA;&#x9;-- Actualiza las personas de menores a 18 años titular y a las personas que no tienen rango mercado */&#xA;&#x9;&#x9;UPDATE H_COMER_STOCK_AFILIA set id_rango_etario_mercado = 0&#xA;&#x9;&#x9;FROM H_COMER_STOCK_AFILIA H &#xA;&#x9;&#x9;WHERE id_rango_etario_mercado is null and id_periodo = @Periodo &#xA;&#xA;&#xA;&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
      </DTS:ObjectData>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:PrecedenceConstraints>
    <DTS:PrecedenceConstraint
      DTS:refId="Package.PrecedenceConstraints[Constraint]"
      DTS:CreationName=""
      DTS:DTSID="{B0D3A7BF-EC5A-4EF6-9D92-6E98BD4CE4AD}"
      DTS:From="Package\Actualiza id_rango_etario_mercado en H_COMER_STOCK_AFILIA"
      DTS:LogicalAnd="True"
      DTS:ObjectName="Constraint"
      DTS:To="Package\Actualiza id_categoria_beneficiario en H_COMER_STOCK_AFILIA" />
  </DTS:PrecedenceConstraints>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml">
        <NodeLayout
          Size="368,44"
          Id="Package\Actualiza id_categoria_beneficiario en H_COMER_STOCK_AFILIA"
          TopLeft="7.38679245283018,80.8584905660377" />
        <NodeLayout
          Size="371,44"
          Id="Package\Actualiza id_rango_etario_mercado en H_COMER_STOCK_AFILIA"
          TopLeft="5.5,5.5" />
        <EdgeLayout
          Id="Package.PrecedenceConstraints[Constraint]"
          TopLeft="191.198113207547,49.4245283018868">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0.377358490566053,31.4339622641509"
              Start="0,0"
              End="0.377358490566053,23.9339622641509">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,15.6981132075472" />
                  <mssgle:LineSegment
                    End="0.377358490566053,15.6981132075472" />
                  <mssgle:LineSegment
                    End="0.377358490566053,23.9339622641509" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
      </GraphLayout>
    </LayoutInfo>
  </Package>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>